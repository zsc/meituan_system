<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>ç¬¬11ç« ï¼šAgentå¹³ç­‰æœåŠ¡ä¸æ™ºèƒ½åŒ–åŒ…å®¹è®¾è®¡</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>ç›®å½•</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="æœç´¢..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¾å›¢è¶…è„‘ç³»ç»Ÿå¤ç°æ•™ç¨‹</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬1ç« ï¼šå›¾çµç®—æ³•å¹³å°</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬2ç« ï¼šå¤§è§„æ¨¡ç‰¹å¾è®¡ç®—</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬3ç« ï¼šæœºå™¨å­¦ä¹ å¹³å°</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬4ç« ï¼šè°ƒåº¦å¼•æ“ - å®æ—¶å¤šäººå¤šç‚¹åˆ†é…</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬5ç« ï¼šè§„åˆ’å¼•æ“ï¼ˆç½‘ç»œ/ç«™ç‚¹/è¿åŠ›ç»“æ„è§„åˆ’ï¼‰</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬6ç« ï¼šETAç³»ç»Ÿ - å…¨é“¾è·¯æ—¶é—´é¢„ä¼°</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬7ç« ï¼šLBSç³»ç»Ÿï¼ˆåœ°å›¾/åœ°å€åº“/è·¯å¾„è§„åˆ’ï¼‰</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬8ç« ï¼šå®šä»·ç³»ç»Ÿ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬9ç« ï¼šç²¾å‡†è¥é”€ä¸ä¼šå‘˜ä½“ç³»</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬10ç« ï¼šåæœºå™¨äººæ»¥ç”¨ä¸è¯„è®ºçœŸå®æ€§ä¿éšœ</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬11ç« ï¼šAgentå¹³ç­‰æœåŠ¡ä¸æ™ºèƒ½åŒ–åŒ…å®¹è®¾è®¡</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬12ç« ï¼šç¾å›¢Appä¸è¶…çº§Appæ¶æ„</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter13.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬13ç« ï¼šMCPæœåŠ¡ä¸å¤šæ™ºèƒ½ä½“ååŒ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter14.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬14ç« ï¼šç³»ç»Ÿé›†æˆä¸å…¨é“¾è·¯ä¼˜åŒ–</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter15.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬15ç« ï¼šLLM/Agent èƒ½åŠ›ä½“ç³»ä¸å®æ–½è·¯çº¿å›¾</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">1) å›¾çµç®—æ³•å¹³å°ï¼ˆç®—æ³•åŸºç¡€è®¾æ–½ï¼‰</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="11agent">ç¬¬11ç« ï¼šAgentå¹³ç­‰æœåŠ¡ä¸æ™ºèƒ½åŒ–åŒ…å®¹è®¾è®¡</h1>
<h2 id="_1">æœ¬ç« å¯¼è¯»</h2>
<p>åœ¨å¤–å–å¹³å°çš„æ¼”è¿›å†ç¨‹ä¸­ï¼Œæˆ‘ä»¬è§è¯äº†ä»çº¯äººå·¥æ“ä½œåˆ°æ™ºèƒ½åŒ–æœåŠ¡çš„è½¬å˜ã€‚å¦‚ä»Šï¼Œè¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·é€šè¿‡æ™ºèƒ½åŠ©æ‰‹ï¼ˆAgentï¼‰ä¸å¹³å°äº¤äº’â€”â€”å¸®åŠ©è€å¹´äººä¸‹å•çš„è¯­éŸ³åŠ©æ‰‹ã€ååŠ©è§†éšœç”¨æˆ·çš„å±å¹•æœ—è¯»å™¨ã€ä»£è¡¨å•†å®¶è‡ªåŠ¨æ¥å•çš„æ™ºèƒ½ç³»ç»Ÿç­‰ã€‚è¿™äº›Agentæ—¢ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„"ç”¨æˆ·"ï¼Œä¹Ÿä¸æ˜¯éœ€è¦é˜²èŒƒçš„"æœºå™¨äºº"ï¼Œè€Œæ˜¯æ•°å­—ä¸–ç•Œä¸­ç”¨æˆ·æ„å¿—çš„å»¶ä¼¸ã€‚</p>
<p>æœ¬ç« å°†æ¢è®¨ä¸€ä¸ªå‰ç»æ€§çš„è®®é¢˜ï¼šå¦‚ä½•æ„å»ºä¸€ä¸ªå¯¹Agentå‹å¥½çš„æœåŠ¡æ¶æ„ï¼Ÿæˆ‘ä»¬éœ€è¦åœ¨ä¿éšœå¹³å°å®‰å…¨çš„å‰æä¸‹ï¼Œå…¬å¹³å¯¹å¾…å„ç±»åˆæ³•Agentï¼Œè®©æŠ€æœ¯çœŸæ­£æœåŠ¡äºäººçš„éœ€æ±‚ã€‚è¿™ä¸ä»…æ˜¯æŠ€æœ¯æ¶æ„çš„å‡çº§ï¼Œæ›´æ˜¯æœåŠ¡ç†å¿µçš„é©æ–°â€”â€”ä»"é˜²å¾¡æ‰€æœ‰è‡ªåŠ¨åŒ–ç¨‹åº"è½¬å‘"æ‹¥æŠ±å–„æ„çš„æ™ºèƒ½åŒ–"ã€‚</p>
<h2 id="_2">å­¦ä¹ ç›®æ ‡</h2>
<p>å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ol>
<li><strong>ç†è§£AgentæœåŠ¡çš„å¿…è¦æ€§</strong>ï¼šæ˜ç¡®ä¸ºä»€ä¹ˆéœ€è¦æ”¯æŒAgentï¼Œä»¥åŠå®ƒå¯¹å¹³å°ç”Ÿæ€çš„ç§¯ææ„ä¹‰</li>
<li><strong>è®¾è®¡ä¿¡ä»»ä½“ç³»</strong>ï¼šæ„å»ºAgentèº«ä»½è®¤è¯å’Œä¿¡ä»»è¯„çº§æœºåˆ¶ï¼Œå®ç°ç²¾ç»†åŒ–ç®¡ç†</li>
<li><strong>åŒºåˆ†å–„æ¶æ„å›¾</strong>ï¼šæŒæ¡åŒºåˆ†å–„æ„Agentä¸æ¶æ„æœºå™¨äººçš„æŠ€æœ¯æ–¹æ³•å’Œä¸šåŠ¡é€»è¾‘</li>
<li><strong>å®ç°åŠ¨æ€é™æµ</strong>ï¼šè®¾è®¡æ™ºèƒ½åŒ–çš„APIé€Ÿç‡é™åˆ¶ç­–ç•¥ï¼Œå¹³è¡¡å®‰å…¨ä¸æ•ˆç‡</li>
<li><strong>ä¼˜åŒ–æ¥å£è®¾è®¡</strong>ï¼šåˆ›å»ºAgentå‹å¥½çš„APIæ¥å£ï¼Œé™ä½é›†æˆé—¨æ§›</li>
<li><strong>å»ºç«‹æˆæƒæœºåˆ¶</strong>ï¼šå®ç°ç”¨æˆ·æˆæƒä¸‹çš„Agentä»£ç†æ¡†æ¶ï¼Œä¿æŠ¤ç”¨æˆ·æƒç›Š</li>
<li><strong>ç¡®ä¿åˆè§„è¿è¥</strong>ï¼šç†è§£ç›¸å…³æ³•å¾‹æ³•è§„è¦æ±‚ï¼Œè®¾è®¡éšç§ä¿æŠ¤æ–¹æ¡ˆ</li>
<li><strong>åŸ¹è‚²å¥åº·ç”Ÿæ€</strong>ï¼šåˆ¶å®šAgentç”Ÿæ€çš„æ¿€åŠ±ä¸æ²»ç†ç­–ç•¥ï¼Œä¿ƒè¿›è‰¯æ€§å‘å±•</li>
</ol>
<h2 id="111-agent">11.1 AgentæœåŠ¡çš„æ¼”è¿›èƒŒæ™¯</h2>
<h3 id="1111">11.1.1 ä»æ’æ–¥åˆ°æ¥çº³çš„è½¬å˜</h3>
<p>æ—©æœŸçš„äº’è”ç½‘æœåŠ¡å°†æ‰€æœ‰è‡ªåŠ¨åŒ–ç¨‹åºè§†ä¸ºæ½œåœ¨å¨èƒã€‚è¿™ç§"ä¸€åˆ€åˆ‡"çš„é˜²å¾¡ç­–ç•¥æºäºå¯¹çˆ¬è™«ã€åˆ·å•ã€DDoSæ”»å‡»ç­‰æ¶æ„è¡Œä¸ºçš„æ‹…å¿§ã€‚éªŒè¯ç ã€è®¾å¤‡æŒ‡çº¹ã€è¡Œä¸ºåˆ†æç­‰åæœºå™¨äººæŠ€æœ¯ä¸æ–­å‡çº§ï¼Œå½¢æˆäº†ä¸€é“é“é˜²çº¿ã€‚</p>
<p>ç„¶è€Œï¼Œéšç€AIæŠ€æœ¯çš„æ™®åŠå’Œç”¨æˆ·éœ€æ±‚çš„æ¼”å˜ï¼Œè¿™ç§ç»å¯¹æ’æ–¥çš„ç«‹åœºå¼€å§‹æ¾åŠ¨ï¼š</p>
<p><strong>è®¤çŸ¥è½¬å˜çš„å…³é”®èŠ‚ç‚¹</strong>ï¼š</p>
<ul>
<li>2016-2018ï¼šè¯­éŸ³åŠ©æ‰‹ï¼ˆSiriã€å°çˆ±åŒå­¦ï¼‰å¼€å§‹ä»£è¡¨ç”¨æˆ·æ‰§è¡Œä»»åŠ¡</li>
<li>2019-2021ï¼šRPAï¼ˆæœºå™¨äººæµç¨‹è‡ªåŠ¨åŒ–ï¼‰åœ¨ä¼ä¸šç«¯å¹¿æ³›åº”ç”¨</li>
<li>2022-2024ï¼šChatGPTç­‰LLMå¸¦æ¥çš„Agenté©å‘½ï¼Œç”¨æˆ·æœŸæœ›AIèƒ½ä»£ç†æ›´å¤šäº‹åŠ¡</li>
</ul>
<div class="codehilite"><pre><span></span><code>ä¼ ç»Ÿé˜²å¾¡æ€ç»´                    åŒ…å®¹æ€§æœåŠ¡æ€ç»´
     â”‚                              â”‚
     â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰€æœ‰Botéƒ½æ˜¯ â”‚              â”‚  åŒºåˆ†å–„æ„   â”‚
â”‚   æ½œåœ¨å¨èƒ  â”‚    â”€â”€â”€â”€â–º     â”‚  ä¸æ¶æ„     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                              â”‚
     â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¨é¢å°å µ   â”‚              â”‚ åˆ†çº§æœåŠ¡   â”‚
â”‚             â”‚    â”€â”€â”€â”€â–º     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>è½¬å˜çš„å†…åœ¨é€»è¾‘</strong>ï¼š</p>
<ol>
<li><strong>ç”¨æˆ·ä½“éªŒä¼˜å…ˆ</strong>ï¼šé˜»æ­¢å–„æ„Agentä¼šæŸå®³çœŸå®ç”¨æˆ·çš„ä½“éªŒ</li>
<li><strong>æ•ˆç‡æå‡éœ€æ±‚</strong>ï¼šAgentå¯ä»¥æé«˜å¹³å°è¿è¥æ•ˆç‡ï¼Œé™ä½æœåŠ¡æˆæœ¬</li>
<li><strong>ç«äº‰å‹åŠ›é©±åŠ¨</strong>ï¼šæ”¯æŒAgentæˆä¸ºå¹³å°å·®å¼‚åŒ–ç«äº‰çš„æ–°ç»´åº¦</li>
<li><strong>ç›‘ç®¡åˆè§„è¦æ±‚</strong>ï¼šæ— éšœç¢è®¿é—®ç­‰æ³•è§„è¦æ±‚å¹³å°æä¾›ç¨‹åºåŒ–æ¥å£</li>
</ol>
<h3 id="1112">11.1.2 ç”¨æˆ·éœ€æ±‚çš„å¤šæ ·åŒ–é©±åŠ¨</h3>
<p>ä¸åŒç”¨æˆ·ç¾¤ä½“å¯¹AgentæœåŠ¡æœ‰ç€è¿«åˆ‡éœ€æ±‚ï¼Œè¿™äº›éœ€æ±‚æ¨åŠ¨ç€å¹³å°å¿…é¡»é‡æ–°æ€è€ƒæœåŠ¡è¾¹ç•Œï¼š</p>
<p><strong>ç‰¹æ®Šç¾¤ä½“çš„åˆšéœ€</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>ç”¨æˆ·ç±»å‹        Agentéœ€æ±‚                 ä»·å€¼ä¸»å¼ 
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è§†éšœç”¨æˆ·    â†’  å±å¹•é˜…è¯»å™¨é›†æˆ      â†’   æ— éšœç¢è®¿é—®
è€å¹´ç”¨æˆ·    â†’  è¯­éŸ³åŠ©æ‰‹ä¸‹å•        â†’   é™ä½ä½¿ç”¨é—¨æ§›  
å¿™ç¢Œç™½é¢†    â†’  è‡ªåŠ¨è®¢é¤è§„åˆ’        â†’   æ—¶é—´èŠ‚çœ
å°å¾®å•†å®¶    â†’  è‡ªåŠ¨æ¥å•ç³»ç»Ÿ        â†’   äººåŠ›æˆæœ¬é™ä½
ä¼ä¸šå®¢æˆ·    â†’  æ‰¹é‡è®¢é¤ç®¡ç†        â†’   æµç¨‹è‡ªåŠ¨åŒ–
</code></pre></div>

<p><strong>å…¸å‹ä½¿ç”¨åœºæ™¯åˆ†æ</strong>ï¼š</p>
<ol>
<li>
<p><strong>è¾…åŠ©æŠ€æœ¯åœºæ™¯</strong>ï¼š
   - å±å¹•é˜…è¯»å™¨éœ€è¦ç»“æ„åŒ–çš„æ•°æ®æ¥å£
   - è¯­éŸ³åŠ©æ‰‹éœ€è¦ç®€åŒ–çš„äº¤äº’æµç¨‹
   - æ‰‹åŠ¿è¯†åˆ«éœ€è¦æ˜ç¡®çš„æ“ä½œåé¦ˆ</p>
</li>
<li>
<p><strong>æ•ˆç‡æå‡åœºæ™¯</strong>ï¼š
   - å®šæ—¶è‡ªåŠ¨ä¸‹å•ï¼ˆå¦‚æ¯æ—¥åˆé¤ï¼‰
   - åŸºäºæ—¥ç¨‹çš„æ™ºèƒ½è®¢é¤å»ºè®®
   - å›¢é¤çš„æ‰¹é‡ä¸‹å•ä¸ç®¡ç†</p>
</li>
<li>
<p><strong>å•†å®¶è‡ªåŠ¨åŒ–åœºæ™¯</strong>ï¼š
   - åº“å­˜ä¸èœå•çš„è‡ªåŠ¨åŒæ­¥
   - è®¢å•çš„è‡ªåŠ¨ç¡®è®¤ä¸åˆ†é…
   - é«˜å³°æœŸçš„æ™ºèƒ½è°ƒåº¦</p>
</li>
</ol>
<h3 id="1113">11.1.3 æŠ€æœ¯æˆç†Ÿåº¦çš„æå‡</h3>
<p>æŠ€æœ¯è¿›æ­¥ä¸ºAgentæœåŠ¡æä¾›äº†åšå®åŸºç¡€ï¼š</p>
<p><strong>å…³é”®æŠ€æœ¯çªç ´</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>æŠ€æœ¯ç»´åº¦              2020å‰              2024ç°çŠ¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
èº«ä»½è®¤è¯    â”‚   ç®€å•Token      â†’    é›¶çŸ¥è¯†è¯æ˜ã€DID
æ„å›¾ç†è§£    â”‚   è§„åˆ™åŒ¹é…      â†’    LLMè¯­ä¹‰ç†è§£  
è¡Œä¸ºåˆ†æ    â”‚   ç»Ÿè®¡ç‰¹å¾      â†’    æ·±åº¦åºåˆ—æ¨¡å‹
ä¿¡ä»»è¯„ä¼°    â”‚   é»‘ç™½åå•      â†’    åŠ¨æ€ä¿¡ä»»ç½‘ç»œ
æ¥å£è®¾è®¡    â”‚   REST API      â†’    GraphQL/gRPC
é™æµç­–ç•¥    â”‚   å›ºå®šé˜ˆå€¼      â†’    è‡ªé€‚åº”ç®—æ³•
</code></pre></div>

<p><strong>æŠ€æœ¯æ ˆçš„ç°ä»£åŒ–</strong>ï¼š</p>
<ol>
<li><strong>èº«ä»½å±‚</strong>ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>DIDï¼ˆå»ä¸­å¿ƒåŒ–èº«ä»½ï¼‰
     â”‚
     â–¼
å¯éªŒè¯å‡­è¯ï¼ˆVCï¼‰
     â”‚
     â–¼
é›¶çŸ¥è¯†è¯æ˜ï¼ˆZKPï¼‰
</code></pre></div>

<ol start="2">
<li><strong>ç†è§£å±‚</strong>ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>è‡ªç„¶è¯­è¨€ â†’ LLMç¼–ç  â†’ æ„å›¾è¯†åˆ« â†’ ä»»åŠ¡è§„åˆ’
             â†“
        å‘é‡æ•°æ®åº“
             â†“  
        ç›¸ä¼¼åº¦åŒ¹é…
</code></pre></div>

<ol start="3">
<li><strong>æ‰§è¡Œå±‚</strong>ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>ä»»åŠ¡åˆ†è§£ â†’ å¹¶è¡Œè°ƒåº¦ â†’ ç»“æœèšåˆ â†’ åé¦ˆå­¦ä¹ 
     â†“         â†“         â†“         â†“
  å¾®æœåŠ¡   æ¶ˆæ¯é˜Ÿåˆ—   ç¼“å­˜å±‚    ML Pipeline
</code></pre></div>

<h3 id="1114">11.1.4 å•†ä¸šä»·å€¼çš„é‡æ–°è®¤è¯†</h3>
<p>ä»çº¯ç²¹çš„æˆæœ¬ä¸­å¿ƒåˆ°æ½œåœ¨çš„å¢é•¿å¼•æ“ï¼ŒAgentæœåŠ¡çš„å•†ä¸šä»·å€¼è¢«é‡æ–°å®šä¹‰ï¼š</p>
<p><strong>ä»·å€¼åˆ›é€ æ¨¡å‹</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>                    Agentç”Ÿæ€ä»·å€¼é“¾
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                             â”‚
    â”‚   å¼€å‘è€…  â†’  Agent  â†’  ç”¨æˆ·  â†’  å¹³å°        â”‚
    â”‚     â†“         â†“        â†“        â†“          â”‚
    â”‚   åˆ›æ–°     æ•ˆç‡     ä½“éªŒ     å¢é•¿          â”‚
    â”‚                                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>é‡åŒ–æ”¶ç›Šåˆ†æ</strong>ï¼š</p>
<ol>
<li>
<p><strong>ç›´æ¥æ”¶ç›Š</strong>ï¼š
   - <strong>äº¤æ˜“é‡æå‡</strong>ï¼šAgenté©±åŠ¨çš„è‡ªåŠ¨ä¸‹å•å æ¯”å¯è¾¾15-20%
   - <strong>å®¢å•ä»·å¢é•¿</strong>ï¼šæ™ºèƒ½æ¨èæå‡å®¢å•ä»·8-12%
   - <strong>è¿è¥æˆæœ¬é™ä½</strong>ï¼šå®¢æœæˆæœ¬é™ä½30-40%</p>
</li>
<li>
<p><strong>é—´æ¥æ”¶ç›Š</strong>ï¼š
   - <strong>ç”¨æˆ·ç²˜æ€§</strong>ï¼šé›†æˆAgentçš„ç”¨æˆ·ç•™å­˜ç‡æå‡25%
   - <strong>ç”Ÿæ€ç¹è£</strong>ï¼šç¬¬ä¸‰æ–¹å¼€å‘è€…è´¡çŒ®åˆ›æ–°åœºæ™¯
   - <strong>æ•°æ®ä»·å€¼</strong>ï¼šAgentäº¤äº’äº§ç”Ÿé«˜è´¨é‡è®­ç»ƒæ•°æ®</p>
</li>
<li>
<p><strong>æˆ˜ç•¥æ”¶ç›Š</strong>ï¼š
   - <strong>å¹³å°æŠ¤åŸæ²³</strong>ï¼šAgentç”Ÿæ€å½¢æˆç½‘ç»œæ•ˆåº”
   - <strong>æ ‡å‡†åˆ¶å®šæƒ</strong>ï¼šå®šä¹‰è¡Œä¸šAgentæœåŠ¡æ ‡å‡†
   - <strong>æœªæ¥å¸ƒå±€</strong>ï¼šä¸ºAGIæ—¶ä»£åšå¥½å‡†å¤‡</p>
</li>
</ol>
<p><strong>ROIè®¡ç®—æ¡†æ¶</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_agent_roi</span><span class="p">(</span><span class="n">metrics</span><span class="p">):</span>
    <span class="c1"># æ”¶ç›Šéƒ¨åˆ†</span>
    <span class="n">revenue_increase</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;é¢å¤–è®¢å•é‡&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;å¹³å‡å®¢å•ä»·&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;å¹³å°æŠ½æˆç‡&#39;</span><span class="p">]</span> <span class="o">+</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;å®¢å•ä»·æå‡&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;æ€»è®¢å•é‡&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;å¹³å°æŠ½æˆç‡&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">cost_savings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;å®¢æœæˆæœ¬èŠ‚çœ&#39;</span><span class="p">]</span> <span class="o">+</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;è¿è¥æ•ˆç‡æå‡ä»·å€¼&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># æˆæœ¬éƒ¨åˆ†  </span>
    <span class="n">development_cost</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;ç ”å‘æŠ•å…¥&#39;</span><span class="p">]</span> <span class="o">+</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;åŸºç¡€è®¾æ–½æˆæœ¬&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">operation_cost</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;å¸¦å®½æˆæœ¬å¢åŠ &#39;</span><span class="p">]</span> <span class="o">+</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;è®¡ç®—èµ„æºæˆæœ¬&#39;</span><span class="p">]</span> <span class="o">+</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;å®‰å…¨é˜²æŠ¤æˆæœ¬&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># ROIè®¡ç®—</span>
    <span class="n">total_benefit</span> <span class="o">=</span> <span class="n">revenue_increase</span> <span class="o">+</span> <span class="n">cost_savings</span>
    <span class="n">total_cost</span> <span class="o">=</span> <span class="n">development_cost</span> <span class="o">+</span> <span class="n">operation_cost</span>
    <span class="n">roi</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_benefit</span> <span class="o">-</span> <span class="n">total_cost</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_cost</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;ROI&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">roi</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>
        <span class="s1">&#39;å›æ”¶æœŸ&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">total_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">total_benefit</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">ä¸ªæœˆ&#39;</span><span class="p">,</span>
        <span class="s1">&#39;å¹´åŒ–æ”¶ç›Š&#39;</span><span class="p">:</span> <span class="n">total_benefit</span> <span class="o">-</span> <span class="n">total_cost</span> <span class="o">*</span> <span class="mf">0.15</span>  <span class="c1"># è€ƒè™‘èµ„é‡‘æˆæœ¬</span>
    <span class="p">}</span>
</code></pre></div>

<p><strong>é•¿æœŸæˆ˜ç•¥ä»·å€¼</strong>ï¼š</p>
<p>éšç€AIæŠ€æœ¯çš„å‘å±•ï¼ŒAgentå°†æˆä¸ºç”¨æˆ·ä¸æ•°å­—ä¸–ç•Œäº¤äº’çš„ä¸»è¦æ–¹å¼ã€‚å¹³å°å¦‚æœä¸èƒ½å¾ˆå¥½åœ°æœåŠ¡Agentï¼Œå°±å¦‚åŒ20å¹´å‰ä¸æ”¯æŒç§»åŠ¨ç«¯ä¸€æ ·ï¼Œå°†å¤±å»æœªæ¥çš„å…¥å£ã€‚ç¾å›¢é€šè¿‡æ„å»ºAgentå‹å¥½çš„æœåŠ¡ä½“ç³»ï¼Œä¸ä»…è§£å†³å½“ä¸‹çš„ç”¨æˆ·éœ€æ±‚ï¼Œæ›´æ˜¯åœ¨ä¸ºAIåŸç”Ÿçš„æœªæ¥å¸ƒå±€ã€‚</p>
<div class="codehilite"><pre><span></span><code>        ä¼ ç»Ÿäº¤äº’                    Agentæ—¶ä»£
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            â”‚            â”‚            â”‚
    â”‚  ç”¨æˆ·â†’ç•Œé¢  â”‚   â”€â”€â”€â”€â–º    â”‚  Agentâ†’API â”‚
    â”‚            â”‚            â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                           â†“
    äººå·¥æ“ä½œä¸ºä¸»                 è‡ªåŠ¨åŒ–ä¸ºä¸»
    åŒæ­¥äº¤äº’                     å¼‚æ­¥åä½œ
    å•ç‚¹æ¥è§¦                     å…¨é“¾è·¯ä»£ç†
</code></pre></div>

<h2 id="112-agent">11.2 Agentèº«ä»½è®¤è¯ä¸ä¿¡ä»»ä½“ç³»</h2>
<p>æ„å»ºå¯é çš„Agentèº«ä»½è®¤è¯å’Œä¿¡ä»»ä½“ç³»æ˜¯å¹³å°å¼€æ”¾æœåŠ¡çš„åŸºç¡€ã€‚ä¸åŒäºä¼ ç»Ÿçš„ç”¨æˆ·è®¤è¯ï¼ŒAgentè®¤è¯éœ€è¦è€ƒè™‘å…¶ä»£ç†æ€§è´¨ã€æŠ€æœ¯èƒ½åŠ›ã€è¡Œä¸ºæ¨¡å¼ç­‰å¤šä¸ªç»´åº¦ã€‚</p>
<h3 id="1121-agent">11.2.1 Agentæ³¨å†Œä¸è®¤è¯æµç¨‹</h3>
<p><strong>å¤šå±‚æ¬¡çš„èº«ä»½ä½“ç³»æ¶æ„</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>                    Agentèº«ä»½è®¤è¯ä½“ç³»
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                              â”‚
    â”‚  L0: åŒ¿åAgentï¼ˆæ— éœ€æ³¨å†Œï¼Œä¸¥æ ¼é™åˆ¶ï¼‰           â”‚
    â”‚  L1: åŸºç¡€è®¤è¯ï¼ˆé‚®ç®±éªŒè¯ï¼ŒåŸºç¡€æƒé™ï¼‰           â”‚
    â”‚  L2: å®åè®¤è¯ï¼ˆèº«ä»½éªŒè¯ï¼Œæ ‡å‡†æƒé™ï¼‰           â”‚  
    â”‚  L3: ä¼ä¸šè®¤è¯ï¼ˆèµ„è´¨å®¡æ ¸ï¼Œé«˜çº§æƒé™ï¼‰           â”‚
    â”‚  L4: å¹³å°è®¤è¯ï¼ˆå®˜æ–¹åˆä½œï¼Œç‰¹æƒè®¿é—®ï¼‰           â”‚
    â”‚                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>æ³¨å†Œæµç¨‹è®¾è®¡</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AgentRegistration</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identity_verifier</span> <span class="o">=</span> <span class="n">IdentityVerifier</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capability_assessor</span> <span class="o">=</span> <span class="n">CapabilityAssessor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compliance_checker</span> <span class="o">=</span> <span class="n">ComplianceChecker</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">register_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
        <span class="c1"># æ­¥éª¤1ï¼šåŸºç¡€ä¿¡æ¯éªŒè¯</span>
        <span class="n">basic_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;agent_name&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;agent_type&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>  <span class="c1"># personal/enterprise/platform</span>
            <span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">],</span>
            <span class="s1">&#39;owner_id&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;owner_id&#39;</span><span class="p">],</span>
            <span class="s1">&#39;technical_spec&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;tech_spec&#39;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># æ­¥éª¤2ï¼šèº«ä»½éªŒè¯</span>
        <span class="k">if</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;enterprise&#39;</span><span class="p">:</span>
            <span class="n">cert_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_enterprise_cert</span><span class="p">(</span><span class="n">application</span><span class="p">[</span><span class="s1">&#39;business_license&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cert_result</span><span class="p">[</span><span class="s1">&#39;valid&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;rejected&#39;</span><span class="p">,</span> <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;ä¼ä¸šèµ„è´¨éªŒè¯å¤±è´¥&#39;</span><span class="p">}</span>

        <span class="c1"># æ­¥éª¤3ï¼šæŠ€æœ¯èƒ½åŠ›è¯„ä¼°</span>
        <span class="n">capability_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capability_assessor</span><span class="o">.</span><span class="n">assess</span><span class="p">({</span>
            <span class="s1">&#39;api_version&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;api_version&#39;</span><span class="p">],</span>
            <span class="s1">&#39;supported_protocols&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;protocols&#39;</span><span class="p">],</span>
            <span class="s1">&#39;rate_limit_compliance&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;rate_limit_test&#39;</span><span class="p">],</span>
            <span class="s1">&#39;error_handling&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;error_handling_test&#39;</span><span class="p">]</span>
        <span class="p">})</span>

        <span class="c1"># æ­¥éª¤4ï¼šåˆè§„æ€§æ£€æŸ¥</span>
        <span class="n">compliance_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compliance_checker</span><span class="o">.</span><span class="n">check</span><span class="p">({</span>
            <span class="s1">&#39;data_usage_policy&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;data_policy&#39;</span><span class="p">],</span>
            <span class="s1">&#39;privacy_statement&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;privacy&#39;</span><span class="p">],</span>
            <span class="s1">&#39;terms_acceptance&#39;</span><span class="p">:</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;terms_accepted&#39;</span><span class="p">]</span>
        <span class="p">})</span>

        <span class="c1"># æ­¥éª¤5ï¼šç”ŸæˆAgentå‡­è¯</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">capability_score</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">compliance_result</span><span class="p">[</span><span class="s1">&#39;passed&#39;</span><span class="p">]]):</span>
            <span class="n">agent_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_agent_id</span><span class="p">(</span><span class="n">basic_info</span><span class="p">)</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">issue_credentials</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">application</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;approved&#39;</span><span class="p">,</span>
                <span class="s1">&#39;agent_id&#39;</span><span class="p">:</span> <span class="n">agent_id</span><span class="p">,</span>
                <span class="s1">&#39;api_key&#39;</span><span class="p">:</span> <span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">],</span>
                <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;secret&#39;</span><span class="p">],</span>
                <span class="s1">&#39;trust_level&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_initial_trust</span><span class="p">(</span><span class="n">application</span><span class="p">),</span>
                <span class="s1">&#39;permissions&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_permissions</span><span class="p">(</span><span class="n">application</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;rejected&#39;</span><span class="p">,</span> <span class="s1">&#39;reasons&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compile_rejection_reasons</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">generate_agent_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="c1"># ç”Ÿæˆå…¨å±€å”¯ä¸€çš„Agent ID</span>
        <span class="n">namespace</span> <span class="o">=</span> <span class="s1">&#39;agent.meituan.com&#39;</span>
        <span class="n">unique_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;agent_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;owner_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;agent_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;agt_</span><span class="si">{</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">unique_string</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">16</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>

<p><strong>å‡­è¯ç®¡ç†æœºåˆ¶</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>å‡­è¯ç±»å‹        ç”¨é€”                  æœ‰æ•ˆæœŸ        åˆ·æ–°æœºåˆ¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
API Key     èº«ä»½æ ‡è¯†              æ°¸ä¹…         æ‰‹åŠ¨é‡ç½®
Secret      ç­¾åå¯†é’¥              æ°¸ä¹…         å®šæœŸè½®æ¢
Access Token è®¿é—®ä»¤ç‰Œ             1å°æ—¶        è‡ªåŠ¨åˆ·æ–°
Refresh Token åˆ·æ–°ä»¤ç‰Œ            30å¤©         é‡æ–°è®¤è¯
Session Token ä¼šè¯ä»¤ç‰Œ            15åˆ†é’Ÿ       æ´»åŠ¨å»¶é•¿
</code></pre></div>

<h3 id="1122">11.2.2 ä¿¡ä»»ç­‰çº§è¯„ä¼°æ¨¡å‹</h3>
<p><strong>å¤šç»´åº¦ä¿¡ä»»è¯„åˆ†ä½“ç³»</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TrustScoreModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;identity_verification&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>   <span class="c1"># èº«ä»½è®¤è¯å¼ºåº¦</span>
            <span class="s1">&#39;historical_behavior&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>     <span class="c1"># å†å²è¡Œä¸ºè¡¨ç°</span>
            <span class="s1">&#39;technical_compliance&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>    <span class="c1"># æŠ€æœ¯è§„èŒƒéµå®ˆ</span>
            <span class="s1">&#39;user_feedback&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>          <span class="c1"># ç”¨æˆ·åé¦ˆè¯„ä»·</span>
            <span class="s1">&#39;security_incidents&#39;</span><span class="p">:</span> <span class="mf">0.15</span>      <span class="c1"># å®‰å…¨äº‹ä»¶è®°å½•</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">calculate_trust_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">):</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># èº«ä»½è®¤è¯ç»´åº¦</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;identity_verification&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_identity_score</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>

        <span class="c1"># å†å²è¡Œä¸ºç»´åº¦</span>
        <span class="n">behavior_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_metrics</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;historical_behavior&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_behavior_score</span><span class="p">(</span><span class="n">behavior_metrics</span><span class="p">)</span>

        <span class="c1"># æŠ€æœ¯åˆè§„ç»´åº¦</span>
        <span class="n">compliance_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compliance_metrics</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;technical_compliance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_compliance_score</span><span class="p">(</span><span class="n">compliance_metrics</span><span class="p">)</span>

        <span class="c1"># ç”¨æˆ·åé¦ˆç»´åº¦</span>
        <span class="n">feedback_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_feedback</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;user_feedback&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_feedback_score</span><span class="p">(</span><span class="n">feedback_data</span><span class="p">)</span>

        <span class="c1"># å®‰å…¨äº‹ä»¶ç»´åº¦</span>
        <span class="n">incident_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_security_incidents</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;security_incidents&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_security_score</span><span class="p">(</span><span class="n">incident_records</span><span class="p">)</span>

        <span class="c1"># åŠ æƒè®¡ç®—æ€»åˆ†</span>
        <span class="n">total_score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;total_score&#39;</span><span class="p">:</span> <span class="n">total_score</span><span class="p">,</span>
            <span class="s1">&#39;dimension_scores&#39;</span><span class="p">:</span> <span class="n">scores</span><span class="p">,</span>
            <span class="s1">&#39;trust_level&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_to_level</span><span class="p">(</span><span class="n">total_score</span><span class="p">),</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">calculate_behavior_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åŸºäºå†å²è¡Œä¸ºè®¡ç®—å¾—åˆ†&quot;&quot;&quot;</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;request_success_rate&#39;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;success_count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;total_requests&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;error_rate&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;error_count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;total_requests&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="s1">&#39;rate_limit_compliance&#39;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;rate_limit_violations&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;api_usage_pattern&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_usage_pattern</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;api_calls&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;data_access_pattern&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_data_pattern</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;data_access&#39;</span><span class="p">])</span>
        <span class="p">}</span>

        <span class="c1"># å¼‚å¸¸æ£€æµ‹</span>
        <span class="n">anomaly_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_anomalies</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

        <span class="c1"># ç»¼åˆè¯„åˆ†</span>
        <span class="n">behavior_score</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;request_success_rate&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">+</span>
            <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;error_rate&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">+</span>
            <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;rate_limit_compliance&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.2</span> <span class="o">+</span>
            <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;api_usage_pattern&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.15</span> <span class="o">+</span>
            <span class="n">factors</span><span class="p">[</span><span class="s1">&#39;data_access_pattern&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.15</span> <span class="o">-</span>
            <span class="n">anomaly_score</span> <span class="o">*</span> <span class="mf">0.3</span>  <span class="c1"># å¼‚å¸¸è¡Œä¸ºæ‰£åˆ†</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">behavior_score</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">score_to_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">score</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å°†æ•°å€¼åˆ†æ•°æ˜ å°„åˆ°ä¿¡ä»»ç­‰çº§&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="mf">0.9</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;platinum&#39;</span>  <span class="c1"># ç™½é‡‘çº§</span>
        <span class="k">elif</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="mf">0.75</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;gold&#39;</span>      <span class="c1"># é»„é‡‘çº§</span>
        <span class="k">elif</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="mf">0.6</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;silver&#39;</span>    <span class="c1"># ç™½é“¶çº§</span>
        <span class="k">elif</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="mf">0.4</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;bronze&#39;</span>    <span class="c1"># é’é“œçº§</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;restricted&#39;</span> <span class="c1"># å—é™çº§</span>
</code></pre></div>

<p><strong>ä¿¡ä»»ç­‰çº§ä¸æƒé™æ˜ å°„</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>ä¿¡ä»»ç­‰çº§    åŸºç¡€é…é¢(QPS)   æ‰¹é‡æ“ä½œ   æ•°æ®è®¿é—®   ç‰¹æ®ŠåŠŸèƒ½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Platinum      10000         1000æ¡     å®Œæ•´      å®æ—¶æ¨é€
Gold          5000          500æ¡      æ ‡å‡†      WebSocket
Silver        1000          100æ¡      åŸºç¡€      é•¿è½®è¯¢
Bronze        100           20æ¡       å—é™      æ ‡å‡†è½®è¯¢
Restricted    10            ç¦ç”¨       æœ€å°      ä»…æŸ¥è¯¢
</code></pre></div>

<h3 id="1123">11.2.3 åŠ¨æ€ä¿¡ä»»åˆ†è°ƒæ•´æœºåˆ¶</h3>
<p><strong>å®æ—¶è°ƒæ•´ç®—æ³•</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">DynamicTrustAdjustment</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjustment_rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_adjustment_rules</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">momentum</span> <span class="o">=</span> <span class="mf">0.9</span>

    <span class="k">def</span> <span class="nf">adjust_trust_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">current_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_score</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">adjustment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_adjustment</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c1"># åº”ç”¨åŠ¨é‡å¹³æ»‘</span>
        <span class="n">historical_trend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_historical_trend</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">smoothed_adjustment</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">momentum</span> <span class="o">*</span> <span class="n">historical_trend</span> <span class="o">+</span> 
            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">momentum</span><span class="p">)</span> <span class="o">*</span> <span class="n">adjustment</span>
        <span class="p">)</span>

        <span class="c1"># è®¡ç®—æ–°åˆ†æ•°</span>
        <span class="n">new_score</span> <span class="o">=</span> <span class="n">current_score</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">smoothed_adjustment</span>
        <span class="n">new_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_score</span><span class="p">))</span>  <span class="c1"># é™åˆ¶åœ¨[0,1]èŒƒå›´</span>

        <span class="c1"># è®°å½•è°ƒæ•´å†å²</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">record_adjustment</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">,</span>
            <span class="s1">&#39;old_score&#39;</span><span class="p">:</span> <span class="n">current_score</span><span class="p">,</span>
            <span class="s1">&#39;new_score&#39;</span><span class="p">:</span> <span class="n">new_score</span><span class="p">,</span>
            <span class="s1">&#39;adjustment&#39;</span><span class="p">:</span> <span class="n">adjustment</span><span class="p">,</span>
            <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_adjustment_reason</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="p">})</span>

        <span class="c1"># è§¦å‘çº§åˆ«å˜æ›´é€šçŸ¥</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_changed</span><span class="p">(</span><span class="n">current_score</span><span class="p">,</span> <span class="n">new_score</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify_level_change</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">new_score</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_score</span>

    <span class="k">def</span> <span class="nf">calculate_adjustment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ ¹æ®äº‹ä»¶ç±»å‹è®¡ç®—ä¿¡ä»»åˆ†è°ƒæ•´å€¼&quot;&quot;&quot;</span>
        <span class="n">adjustments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># æ­£å‘äº‹ä»¶</span>
            <span class="s1">&#39;successful_transaction&#39;</span><span class="p">:</span> <span class="o">+</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="s1">&#39;positive_user_feedback&#39;</span><span class="p">:</span> <span class="o">+</span><span class="mf">0.02</span><span class="p">,</span>
            <span class="s1">&#39;security_contribution&#39;</span><span class="p">:</span> <span class="o">+</span><span class="mf">0.05</span><span class="p">,</span>    <span class="c1"># æŠ¥å‘Šæ¼æ´ç­‰</span>
            <span class="s1">&#39;consistent_good_behavior&#39;</span><span class="p">:</span> <span class="o">+</span><span class="mf">0.03</span><span class="p">,</span>

            <span class="c1"># è´Ÿå‘äº‹ä»¶</span>
            <span class="s1">&#39;rate_limit_violation&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="s1">&#39;api_abuse_detected&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.10</span><span class="p">,</span>
            <span class="s1">&#39;user_complaint&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.08</span><span class="p">,</span>
            <span class="s1">&#39;security_incident&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.20</span><span class="p">,</span>
            <span class="s1">&#39;data_breach_attempt&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.50</span><span class="p">,</span>

            <span class="c1"># ä¸­æ€§äº‹ä»¶</span>
            <span class="s1">&#39;normal_operation&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;maintenance_period&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>

        <span class="n">base_adjustment</span> <span class="o">=</span> <span class="n">adjustments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># è€ƒè™‘äº‹ä»¶ä¸¥é‡ç¨‹åº¦</span>
        <span class="n">severity_multiplier</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;severity&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># è€ƒè™‘æ—¶é—´è¡°å‡ï¼ˆrecent events have more impactï¼‰</span>
        <span class="n">time_decay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_time_decay</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">base_adjustment</span> <span class="o">*</span> <span class="n">severity_multiplier</span> <span class="o">*</span> <span class="n">time_decay</span>

    <span class="k">def</span> <span class="nf">emergency_trust_freeze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç´§æ€¥å†»ç»“ä¿¡ä»»åˆ†&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_agent_status</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="s1">&#39;frozen&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_trust_score</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_security_team</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_security_event</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="s1">&#39;trust_freeze&#39;</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
</code></pre></div>

<h3 id="1124">11.2.4 è·¨å¹³å°èº«ä»½äº’è®¤</h3>
<p><strong>è”é‚¦èº«ä»½è®¤è¯æ¶æ„</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>         ç¾å›¢å¹³å°                    ç¬¬ä¸‰æ–¹å¹³å°
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              â”‚            â”‚              â”‚
    â”‚  Agentè®¤è¯   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  OAuth 2.0   â”‚
    â”‚   ä¸­å¿ƒ       â”‚            â”‚   Provider   â”‚
    â”‚              â”‚            â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                            â”‚
           â–¼                            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ä¿¡ä»»æ˜ å°„   â”‚            â”‚   ä¿¡èª‰å…±äº«   â”‚
    â”‚    è§„åˆ™      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚    åè®®      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>è·¨å¹³å°ä¿¡ä»»æ˜ å°„</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CrossPlatformTrustMapper</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">platform_mappings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;google&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;api&#39;</span><span class="p">:</span> <span class="s1">&#39;oauth2.googleapis.com&#39;</span><span class="p">},</span>
            <span class="s1">&#39;microsoft&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;api&#39;</span><span class="p">:</span> <span class="s1">&#39;login.microsoftonline.com&#39;</span><span class="p">},</span>
            <span class="s1">&#39;github&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;api&#39;</span><span class="p">:</span> <span class="s1">&#39;github.com/login/oauth&#39;</span><span class="p">},</span>
            <span class="s1">&#39;wechat&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;api&#39;</span><span class="p">:</span> <span class="s1">&#39;open.weixin.qq.com&#39;</span><span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">import_external_trust</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">external_identity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¯¼å…¥å¤–éƒ¨å¹³å°çš„ä¿¡ä»»å‡­è¯&quot;&quot;&quot;</span>
        <span class="n">platform</span> <span class="o">=</span> <span class="n">external_identity</span><span class="p">[</span><span class="s1">&#39;platform&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform_mappings</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># éªŒè¯å¤–éƒ¨èº«ä»½</span>
        <span class="n">verification_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_external_identity</span><span class="p">(</span>
            <span class="n">platform</span><span class="p">,</span>
            <span class="n">external_identity</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">verification_result</span><span class="p">[</span><span class="s1">&#39;valid&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># è·å–å¤–éƒ¨ä¿¡èª‰æ•°æ®</span>
        <span class="n">external_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_external_reputation</span><span class="p">(</span>
            <span class="n">platform</span><span class="p">,</span>
            <span class="n">external_identity</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># è½¬æ¢ä¸ºå†…éƒ¨ä¿¡ä»»åˆ†</span>
        <span class="n">internal_trust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_internal_trust</span><span class="p">(</span>
            <span class="n">platform</span><span class="p">,</span>
            <span class="n">external_reputation</span>
        <span class="p">)</span>

        <span class="c1"># åˆ›å»ºå…³è”è®°å½•</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_identity_link</span><span class="p">({</span>
            <span class="s1">&#39;internal_agent_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_internal_id</span><span class="p">(),</span>
            <span class="s1">&#39;external_platform&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="p">,</span>
            <span class="s1">&#39;external_id&#39;</span><span class="p">:</span> <span class="n">external_identity</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">],</span>
            <span class="s1">&#39;trust_score&#39;</span><span class="p">:</span> <span class="n">internal_trust</span><span class="p">,</span>
            <span class="s1">&#39;verification_time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="s1">&#39;expiry&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">internal_trust</span>

    <span class="k">def</span> <span class="nf">convert_to_internal_trust</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">,</span> <span class="n">external_rep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å°†å¤–éƒ¨ä¿¡èª‰è½¬æ¢ä¸ºå†…éƒ¨ä¿¡ä»»åˆ†&quot;&quot;&quot;</span>
        <span class="n">platform_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform_mappings</span><span class="p">[</span><span class="n">platform</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>

        <span class="c1"># æ ‡å‡†åŒ–å¤–éƒ¨åˆ†æ•°</span>
        <span class="n">normalized_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_external_score</span><span class="p">(</span><span class="n">platform</span><span class="p">,</span> <span class="n">external_rep</span><span class="p">)</span>

        <span class="c1"># åº”ç”¨å¹³å°æƒé‡</span>
        <span class="n">weighted_score</span> <span class="o">=</span> <span class="n">normalized_score</span> <span class="o">*</span> <span class="n">platform_weight</span>

        <span class="c1"># åº”ç”¨åˆå§‹æŠ˜æ‰£ï¼ˆæ–°å¯¼å…¥çš„ä¿¡ä»»éœ€è¦æœ¬åœ°éªŒè¯ï¼‰</span>
        <span class="n">initial_discount</span> <span class="o">=</span> <span class="mf">0.8</span>

        <span class="k">return</span> <span class="n">weighted_score</span> <span class="o">*</span> <span class="n">initial_discount</span>
</code></pre></div>

<p><strong>å»ä¸­å¿ƒåŒ–èº«ä»½ï¼ˆDIDï¼‰æ”¯æŒ</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">DIDIntegration</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">did_resolver</span> <span class="o">=</span> <span class="n">DIDResolver</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifiable_credentials</span> <span class="o">=</span> <span class="n">VCVerifier</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">verify_did_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">did_document</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;éªŒè¯åŸºäºDIDçš„Agentèº«ä»½&quot;&quot;&quot;</span>
        <span class="c1"># è§£æDID</span>
        <span class="n">did</span> <span class="o">=</span> <span class="n">did_document</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>  <span class="c1"># å¦‚: did:meituan:agent:12345</span>

        <span class="c1"># éªŒè¯DIDæ–‡æ¡£ç­¾å</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_signature</span><span class="p">(</span><span class="n">did_document</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;valid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;ç­¾åéªŒè¯å¤±è´¥&#39;</span><span class="p">}</span>

        <span class="c1"># éªŒè¯å¯éªŒè¯å‡­è¯</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">did_document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verifiableCredential&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">verified_claims</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">credential</span> <span class="ow">in</span> <span class="n">credentials</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verifiable_credentials</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">credential</span><span class="p">):</span>
                <span class="n">verified_claims</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">credential</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;issuer&#39;</span><span class="p">:</span> <span class="n">credential</span><span class="p">[</span><span class="s1">&#39;issuer&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;claims&#39;</span><span class="p">:</span> <span class="n">credential</span><span class="p">[</span><span class="s1">&#39;credentialSubject&#39;</span><span class="p">]</span>
                <span class="p">})</span>

        <span class="c1"># æ„å»ºä¿¡ä»»æ¡£æ¡ˆ</span>
        <span class="n">trust_profile</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;did&#39;</span><span class="p">:</span> <span class="n">did</span><span class="p">,</span>
            <span class="s1">&#39;verified_claims&#39;</span><span class="p">:</span> <span class="n">verified_claims</span><span class="p">,</span>
            <span class="s1">&#39;trust_score&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_did_trust</span><span class="p">(</span><span class="n">verified_claims</span><span class="p">),</span>
            <span class="s1">&#39;capabilities&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_capabilities</span><span class="p">(</span><span class="n">verified_claims</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;valid&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="n">trust_profile</span><span class="p">}</span>
</code></pre></div>

<h2 id="113-agent">11.3 å–„æ„Agentä¸æ¶æ„æœºå™¨äººçš„åŒºåˆ†</h2>
<p>åŒºåˆ†å–„æ„Agentä¸æ¶æ„æœºå™¨äººæ˜¯å¹³å°å®‰å…¨çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚ä¼ ç»Ÿçš„åçˆ¬è™«æŠ€æœ¯å¾€å¾€é‡‡ç”¨"å®å¯é”™æ€ä¸€åƒï¼Œä¸å¯æ”¾è¿‡ä¸€ä¸ª"çš„ç­–ç•¥ï¼Œä½†åœ¨AgentæœåŠ¡æ—¶ä»£ï¼Œæˆ‘ä»¬éœ€è¦æ›´ç²¾ç»†çš„è¯†åˆ«æœºåˆ¶ï¼Œæ—¢è¦ä¿æŠ¤å¹³å°å®‰å…¨ï¼Œåˆè¦é¿å…è¯¯ä¼¤åˆæ³•Agentã€‚</p>
<h3 id="1131">11.3.1 è¡Œä¸ºæ¨¡å¼ç‰¹å¾åˆ†æ</h3>
<p><strong>è¡Œä¸ºç‰¹å¾çš„å¤šç»´åº¦åˆ»ç”»</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>                    è¡Œä¸ºç‰¹å¾ç»´åº¦åˆ†æ
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                â”‚
    â”‚   æ—¶åºç‰¹å¾  â†â†’  ç©ºé—´ç‰¹å¾  â†â†’  å†…å®¹ç‰¹å¾       â”‚
    â”‚       â†“            â†“            â†“             â”‚
    â”‚   é¢‘ç‡åˆ†å¸ƒ      è®¿é—®è·¯å¾„      æ•°æ®æ¨¡å¼        â”‚
    â”‚       â†“            â†“            â†“             â”‚
    â”‚   å‘¨æœŸè§„å¾‹      åœ°ç†åˆ†å¸ƒ      è¯­ä¹‰å…³è”        â”‚
    â”‚                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>å–„æ„Agentçš„å…¸å‹è¡Œä¸ºæ¨¡å¼</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">BenignAgentPatterns</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;time_patterns&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;request_interval&#39;</span><span class="p">:</span> <span class="s1">&#39;regular_with_variance&#39;</span><span class="p">,</span>  <span class="c1"># è§„å¾‹ä½†æœ‰è‡ªç„¶æ³¢åŠ¨</span>
                <span class="s1">&#39;active_hours&#39;</span><span class="p">:</span> <span class="s1">&#39;business_hours_aligned&#39;</span><span class="p">,</span>     <span class="c1"># ç¬¦åˆä¸šåŠ¡æ—¶é—´</span>
                <span class="s1">&#39;burst_behavior&#39;</span><span class="p">:</span> <span class="s1">&#39;task_driven&#39;</span><span class="p">,</span>              <span class="c1"># çªå‘ä½†æœ‰ä¸šåŠ¡é€»è¾‘</span>
                <span class="s1">&#39;retry_pattern&#39;</span><span class="p">:</span> <span class="s1">&#39;exponential_backoff&#39;</span>        <span class="c1"># è§„èŒƒçš„é‡è¯•ç­–ç•¥</span>
            <span class="p">},</span>
            <span class="s1">&#39;access_patterns&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;api_usage&#39;</span><span class="p">:</span> <span class="s1">&#39;consistent_subset&#39;</span><span class="p">,</span>             <span class="c1"># ç¨³å®šä½¿ç”¨APIå­é›†</span>
                <span class="s1">&#39;data_access&#39;</span><span class="p">:</span> <span class="s1">&#39;authorized_scope&#39;</span><span class="p">,</span>            <span class="c1"># è®¿é—®æˆæƒèŒƒå›´å†…æ•°æ®</span>
                <span class="s1">&#39;navigation&#39;</span><span class="p">:</span> <span class="s1">&#39;logical_flow&#39;</span><span class="p">,</span>                 <span class="c1"># é€»è¾‘è¿è´¯çš„è®¿é—®è·¯å¾„</span>
                <span class="s1">&#39;error_handling&#39;</span><span class="p">:</span> <span class="s1">&#39;graceful_degradation&#39;</span>      <span class="c1"># ä¼˜é›…çš„é”™è¯¯å¤„ç†</span>
            <span class="p">},</span>
            <span class="s1">&#39;content_patterns&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;query_diversity&#39;</span><span class="p">:</span> <span class="s1">&#39;business_relevant&#39;</span><span class="p">,</span>       <span class="c1"># æŸ¥è¯¢å†…å®¹ä¸šåŠ¡ç›¸å…³</span>
                <span class="s1">&#39;data_correlation&#39;</span><span class="p">:</span> <span class="s1">&#39;contextual&#39;</span><span class="p">,</span>             <span class="c1"># æ•°æ®è¯·æ±‚æœ‰ä¸Šä¸‹æ–‡</span>
                <span class="s1">&#39;payload_structure&#39;</span><span class="p">:</span> <span class="s1">&#39;well_formed&#39;</span><span class="p">,</span>           <span class="c1"># è§„èŒƒçš„è¯·æ±‚æ ¼å¼</span>
                <span class="s1">&#39;response_handling&#39;</span><span class="p">:</span> <span class="s1">&#39;complete_processing&#39;</span>    <span class="c1"># å®Œæ•´å¤„ç†å“åº”</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">analyze_agent_behavior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_logs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆ†æAgentè¡Œä¸ºæ˜¯å¦ç¬¦åˆå–„æ„æ¨¡å¼&quot;&quot;&quot;</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># æ—¶åºåˆ†æ</span>
        <span class="n">time_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_time_features</span><span class="p">(</span><span class="n">agent_logs</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;time_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_time_pattern</span><span class="p">(</span><span class="n">time_features</span><span class="p">)</span>

        <span class="c1"># è®¿é—®æ¨¡å¼åˆ†æ</span>
        <span class="n">access_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_access_features</span><span class="p">(</span><span class="n">agent_logs</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;access_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_access_pattern</span><span class="p">(</span><span class="n">access_features</span><span class="p">)</span>

        <span class="c1"># å†…å®¹åˆ†æ</span>
        <span class="n">content_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_content_features</span><span class="p">(</span><span class="n">agent_logs</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;content_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_content_pattern</span><span class="p">(</span><span class="n">content_features</span><span class="p">)</span>

        <span class="c1"># ç»¼åˆè¯„åˆ†</span>
        <span class="n">benign_probability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_benign_probability</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;is_benign&#39;</span><span class="p">:</span> <span class="n">benign_probability</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">,</span>
            <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">benign_probability</span><span class="p">,</span>
            <span class="s1">&#39;evidence&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compile_evidence</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
            <span class="s1">&#39;recommendations&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_recommendations</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">extract_time_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æå–æ—¶åºç‰¹å¾&quot;&quot;&quot;</span>
        <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">]</span>
        <span class="n">intervals</span> <span class="o">=</span> <span class="p">[</span><span class="n">timestamps</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">timestamps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;mean_interval&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">intervals</span><span class="p">),</span>
            <span class="s1">&#39;std_interval&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">intervals</span><span class="p">),</span>
            <span class="s1">&#39;periodicity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_periodicity</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span>
            <span class="s1">&#39;burst_count&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_bursts</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span>
            <span class="s1">&#39;daily_pattern&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_daily_pattern</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span>
            <span class="s1">&#39;weekly_pattern&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_weekly_pattern</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">evaluate_time_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¯„ä¼°æ—¶é—´æ¨¡å¼çš„å–„æ„ç¨‹åº¦&quot;&quot;&quot;</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># æ£€æŸ¥è¯·æ±‚é—´éš”</span>
        <span class="k">if</span> <span class="n">features</span><span class="p">[</span><span class="s1">&#39;mean_interval&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># å°äº100ms</span>
            <span class="n">score</span> <span class="o">*=</span> <span class="mf">0.3</span>  <span class="c1"># è¿‡äºé¢‘ç¹ï¼Œå¯èƒ½æ˜¯æ¶æ„</span>
        <span class="k">elif</span> <span class="n">features</span><span class="p">[</span><span class="s1">&#39;mean_interval&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>  <span class="c1"># å¤§äº1ç§’</span>
            <span class="n">score</span> <span class="o">*=</span> <span class="mf">1.0</span>  <span class="c1"># æ­£å¸¸é—´éš”</span>

        <span class="c1"># æ£€æŸ¥é—´éš”ç¨³å®šæ€§</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="s1">&#39;std_interval&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">features</span><span class="p">[</span><span class="s1">&#39;mean_interval&#39;</span><span class="p">]</span>  <span class="c1"># å˜å¼‚ç³»æ•°</span>
        <span class="k">if</span> <span class="n">cv</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># è¿‡äºè§„å¾‹</span>
            <span class="n">score</span> <span class="o">*=</span> <span class="mf">0.5</span>  <span class="c1"># å¯èƒ½æ˜¯ç®€å•è„šæœ¬</span>
        <span class="k">elif</span> <span class="n">cv</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">:</span>  <span class="c1"># è¿‡äºéšæœº</span>
            <span class="n">score</span> <span class="o">*=</span> <span class="mf">0.7</span>  <span class="c1"># å¯èƒ½æ˜¯ä¼ªè£…</span>

        <span class="c1"># æ£€æŸ¥å‘¨æœŸæ€§</span>
        <span class="k">if</span> <span class="n">features</span><span class="p">[</span><span class="s1">&#39;periodicity&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>  <span class="c1"># å¼ºå‘¨æœŸæ€§</span>
            <span class="n">score</span> <span class="o">*=</span> <span class="mf">0.9</span>  <span class="c1"># æ­£å¸¸çš„å®šæ—¶ä»»åŠ¡</span>

        <span class="k">return</span> <span class="n">score</span>
</code></pre></div>

<p><strong>æ¶æ„æœºå™¨äººçš„è¡Œä¸ºç‰¹å¾</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MaliciousRobotPatterns</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;scraping_behavior&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;sequential_id_access&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>      <span class="c1"># é¡ºåºéå†ID</span>
                <span class="s1">&#39;full_catalog_scan&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>         <span class="c1"># å…¨é‡æ‰«æ</span>
                <span class="s1">&#39;no_user_context&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>           <span class="c1"># æ— ç”¨æˆ·ä¸Šä¸‹æ–‡</span>
                <span class="s1">&#39;ignore_response&#39;</span><span class="p">:</span> <span class="kc">True</span>            <span class="c1"># ä¸å¤„ç†å“åº”å†…å®¹</span>
            <span class="p">},</span>
            <span class="s1">&#39;attack_behavior&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;credential_stuffing&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>       <span class="c1"># æ’åº“æ”»å‡»</span>
                <span class="s1">&#39;parameter_fuzzing&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>         <span class="c1"># å‚æ•°æ¨¡ç³Šæµ‹è¯•</span>
                <span class="s1">&#39;injection_attempts&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>        <span class="c1"># æ³¨å…¥å°è¯•</span>
                <span class="s1">&#39;privilege_escalation&#39;</span><span class="p">:</span> <span class="kc">True</span>       <span class="c1"># æƒé™æå‡</span>
            <span class="p">},</span>
            <span class="s1">&#39;abuse_behavior&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;fake_order_creation&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>       <span class="c1"># è™šå‡è®¢å•</span>
                <span class="s1">&#39;inventory_hoarding&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>        <span class="c1"># åº“å­˜å ç”¨</span>
                <span class="s1">&#39;price_manipulation&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>        <span class="c1"># ä»·æ ¼æ“çºµ</span>
                <span class="s1">&#39;review_bombing&#39;</span><span class="p">:</span> <span class="kc">True</span>             <span class="c1"># è¯„è®ºè½°ç‚¸</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">detect_malicious_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">behavior_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æµ‹æ¶æ„è¡Œä¸ºæ¨¡å¼&quot;&quot;&quot;</span>
        <span class="n">detections</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># çˆ¬è™«æ£€æµ‹</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_scraping</span><span class="p">(</span><span class="n">behavior_data</span><span class="p">):</span>
            <span class="n">detections</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;scraping&#39;</span><span class="p">,</span>
                <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_scraping_confidence</span><span class="p">(</span><span class="n">behavior_data</span><span class="p">),</span>
                <span class="s1">&#39;evidence&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_scraping_evidence</span><span class="p">(</span><span class="n">behavior_data</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="c1"># æ”»å‡»æ£€æµ‹</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_attacking</span><span class="p">(</span><span class="n">behavior_data</span><span class="p">):</span>
            <span class="n">detections</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;attack&#39;</span><span class="p">,</span>
                <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assess_attack_severity</span><span class="p">(</span><span class="n">behavior_data</span><span class="p">),</span>
                <span class="s1">&#39;attack_vector&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_attack_vector</span><span class="p">(</span><span class="n">behavior_data</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="c1"># æ»¥ç”¨æ£€æµ‹</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_abusing</span><span class="p">(</span><span class="n">behavior_data</span><span class="p">):</span>
            <span class="n">detections</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;abuse&#39;</span><span class="p">,</span>
                <span class="s1">&#39;impact&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_abuse_impact</span><span class="p">(</span><span class="n">behavior_data</span><span class="p">),</span>
                <span class="s1">&#39;pattern&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">classify_abuse_pattern</span><span class="p">(</span><span class="n">behavior_data</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;is_malicious&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">detections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;detections&#39;</span><span class="p">:</span> <span class="n">detections</span><span class="p">,</span>
            <span class="s1">&#39;risk_level&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_risk_level</span><span class="p">(</span><span class="n">detections</span><span class="p">),</span>
            <span class="s1">&#39;recommended_action&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">recommend_action</span><span class="p">(</span><span class="n">detections</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">is_scraping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆ¤æ–­æ˜¯å¦ä¸ºçˆ¬è™«è¡Œä¸º&quot;&quot;&quot;</span>
        <span class="n">indicators</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;sequential_access&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_sequential_pattern</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="s1">&#39;coverage_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_coverage_ratio</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="s1">&#39;response_time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_response_time</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="s1">&#39;user_agent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_user_agent</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="s1">&#39;referer_chain&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_referer_chain</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># åŠ æƒè¯„åˆ†</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;sequential_access&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
            <span class="s1">&#39;coverage_ratio&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
            <span class="s1">&#39;response_time&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>
            <span class="s1">&#39;user_agent&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>
            <span class="s1">&#39;referer_chain&#39;</span><span class="p">:</span> <span class="mf">0.15</span>
        <span class="p">}</span>

        <span class="n">score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">indicators</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">indicators</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mf">0.6</span>
</code></pre></div>

<h3 id="1132">11.3.2 æ„å›¾è¯†åˆ«ä¸åˆ†ç±»</h3>
<p><strong>åŸºäºLLMçš„æ„å›¾ç†è§£</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">IntentClassification</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm_analyzer</span> <span class="o">=</span> <span class="n">LLMIntentAnalyzer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rule_engine</span> <span class="o">=</span> <span class="n">RuleBasedClassifier</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ml_classifier</span> <span class="o">=</span> <span class="n">MLIntentClassifier</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">classify_agent_intent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤šæ¨¡å‹èåˆçš„æ„å›¾åˆ†ç±»&quot;&quot;&quot;</span>
        <span class="c1"># LLMåˆ†æ</span>
        <span class="n">llm_intent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">({</span>
            <span class="s1">&#39;api_calls&#39;</span><span class="p">:</span> <span class="n">agent_data</span><span class="p">[</span><span class="s1">&#39;api_sequence&#39;</span><span class="p">],</span>
            <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="n">agent_data</span><span class="p">[</span><span class="s1">&#39;request_params&#39;</span><span class="p">],</span>
            <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="n">agent_data</span><span class="p">[</span><span class="s1">&#39;timing_pattern&#39;</span><span class="p">]</span>
        <span class="p">})</span>

        <span class="c1"># è§„åˆ™å¼•æ“åˆ¤æ–­</span>
        <span class="n">rule_intent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule_engine</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">agent_data</span><span class="p">)</span>

        <span class="c1"># MLæ¨¡å‹é¢„æµ‹</span>
        <span class="n">ml_intent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">agent_data</span><span class="p">)</span>

        <span class="c1"># èåˆå†³ç­–</span>
        <span class="n">final_intent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusion_decision</span><span class="p">(</span><span class="n">llm_intent</span><span class="p">,</span> <span class="n">rule_intent</span><span class="p">,</span> <span class="n">ml_intent</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;primary_intent&#39;</span><span class="p">:</span> <span class="n">final_intent</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">],</span>
            <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">final_intent</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">],</span>
            <span class="s1">&#39;sub_intents&#39;</span><span class="p">:</span> <span class="n">final_intent</span><span class="p">[</span><span class="s1">&#39;sub_categories&#39;</span><span class="p">],</span>
            <span class="s1">&#39;explanation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_explanation</span><span class="p">(</span><span class="n">final_intent</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">fusion_decision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">ml</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤šæ¨¡å‹èåˆå†³ç­–&quot;&quot;&quot;</span>
        <span class="c1"># æ„å›¾ç±»åˆ«å®šä¹‰</span>
        <span class="n">intent_categories</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;legitimate_automation&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;user_assistance&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>      <span class="c1"># ç”¨æˆ·è¾…åŠ©</span>
                <span class="s1">&#39;business_integration&#39;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span> <span class="c1"># ä¸šåŠ¡é›†æˆ</span>
                <span class="s1">&#39;accessibility&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>        <span class="c1"># æ— éšœç¢è®¿é—®</span>
                <span class="s1">&#39;testing&#39;</span><span class="p">:</span> <span class="mf">0.8</span>               <span class="c1"># åˆæ³•æµ‹è¯•</span>
            <span class="p">},</span>
            <span class="s1">&#39;gray_area&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;research&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>             <span class="c1"># ç ”ç©¶ç›®çš„</span>
                <span class="s1">&#39;monitoring&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>           <span class="c1"># ç›‘æ§åˆ†æ</span>
                <span class="s1">&#39;aggregation&#39;</span><span class="p">:</span> <span class="mf">0.4</span>           <span class="c1"># æ•°æ®èšåˆ</span>
            <span class="p">},</span>
            <span class="s1">&#39;malicious&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;scraping&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>             <span class="c1"># æ¶æ„çˆ¬å–</span>
                <span class="s1">&#39;attack&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>               <span class="c1"># æ”»å‡»è¡Œä¸º</span>
                <span class="s1">&#39;fraud&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>                <span class="c1"># æ¬ºè¯ˆæ´»åŠ¨</span>
                <span class="s1">&#39;abuse&#39;</span><span class="p">:</span> <span class="mf">0.05</span>                <span class="c1"># å¹³å°æ»¥ç”¨</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># åŠ æƒæŠ•ç¥¨</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;llm&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;rule&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;ml&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">}</span>
        <span class="n">combined_scores</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">intent_categories</span><span class="p">:</span>
            <span class="n">combined_scores</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">llm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="s1">&#39;llm&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="s1">&#39;rule&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">ml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="s1">&#39;ml&#39;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># é€‰æ‹©æœ€é«˜åˆ†ç±»åˆ«</span>
        <span class="n">best_category</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">combined_scores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">combined_scores</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">best_category</span><span class="p">,</span>
            <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">combined_scores</span><span class="p">[</span><span class="n">best_category</span><span class="p">],</span>
            <span class="s1">&#39;sub_categories&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_sub_categories</span><span class="p">(</span><span class="n">best_category</span><span class="p">,</span> <span class="n">agent_data</span><span class="p">),</span>
            <span class="s1">&#39;all_scores&#39;</span><span class="p">:</span> <span class="n">combined_scores</span>
        <span class="p">}</span>
</code></pre></div>

<p><strong>æ„å›¾åˆ†ç±»çš„ä¸šåŠ¡è§„åˆ™</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="err">æ„å›¾ç±»åˆ«æ ‘ï¼š</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">åˆæ³•è‡ªåŠ¨åŒ–ï¼ˆ</span><span class="n">Legitimate</span><span class="w"> </span><span class="n">Automation</span><span class="err">ï¼‰</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">è¾…åŠ©æŠ€æœ¯ï¼ˆ</span><span class="n">Assistive</span><span class="w"> </span><span class="n">Technology</span><span class="err">ï¼‰</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">å±å¹•é˜…è¯»å™¨</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">è¯­éŸ³æ§åˆ¶</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">æ‰‹åŠ¿è½¬æ¢</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">ä¸šåŠ¡é›†æˆï¼ˆ</span><span class="n">Business</span><span class="w"> </span><span class="n">Integration</span><span class="err">ï¼‰</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">ERPå¯¹æ¥</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">è´¢åŠ¡ç³»ç»Ÿ</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">ä¾›åº”é“¾ç®¡ç†</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">ç”¨æˆ·ä»£ç†ï¼ˆ</span><span class="n">User</span><span class="w"> </span><span class="n">Proxy</span><span class="err">ï¼‰</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">æ™ºèƒ½åŠ©æ‰‹</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">æ—¥ç¨‹ç®¡ç†</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">æ‰¹é‡æ“ä½œ</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">å¼€å‘æµ‹è¯•ï¼ˆ</span><span class="n">Development</span><span class="err">ï¼‰</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">APIæµ‹è¯•</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">æ€§èƒ½ç›‘æ§</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">é›†æˆæµ‹è¯•</span>
<span class="err">â”‚</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">ç°è‰²åœ°å¸¦ï¼ˆ</span><span class="n">Gray</span><span class="w"> </span><span class="n">Area</span><span class="err">ï¼‰</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">æ•°æ®åˆ†æï¼ˆ</span><span class="n">Data</span><span class="w"> </span><span class="n">Analysis</span><span class="err">ï¼‰</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">å¸‚åœºç ”ç©¶</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">ä»·æ ¼ç›‘æ§</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">ç«å“åˆ†æ</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">èšåˆæœåŠ¡ï¼ˆ</span><span class="n">Aggregation</span><span class="err">ï¼‰</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">æ¯”ä»·å¹³å°</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">ä¿¡æ¯æ•´åˆ</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">æ¨èç³»ç»Ÿ</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">ç›‘æ§å‘Šè­¦ï¼ˆ</span><span class="n">Monitoring</span><span class="err">ï¼‰</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">å¯ç”¨æ€§ç›‘æ§</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">åº“å­˜æé†’</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">ä»·æ ¼å˜åŠ¨</span>
<span class="err">â”‚</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">æ¶æ„è¡Œä¸ºï¼ˆ</span><span class="n">Malicious</span><span class="err">ï¼‰</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">æ•°æ®çªƒå–ï¼ˆ</span><span class="n">Data</span><span class="w"> </span><span class="n">Theft</span><span class="err">ï¼‰</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">ç”¨æˆ·ä¿¡æ¯</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">å•†ä¸šæœºå¯†</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">å®šä»·ç­–ç•¥</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">å¹³å°æ”»å‡»ï¼ˆ</span><span class="n">Platform</span><span class="w"> </span><span class="n">Attack</span><span class="err">ï¼‰</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">DDoSæ”»å‡»</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">æ³¨å…¥æ”»å‡»</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">è¶Šæƒè®¿é—®</span>
<span class="w">    </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">ä¸šåŠ¡æ¬ºè¯ˆï¼ˆ</span><span class="n">Business</span><span class="w"> </span><span class="n">Fraud</span><span class="err">ï¼‰</span>
<span class="w">        </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">åˆ·å•åˆ·è¯„</span>
<span class="w">        </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="err">è™šå‡äº¤æ˜“</span>
<span class="w">        </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">åº“å­˜å ç”¨</span>
</code></pre></div>

<h3 id="1133">11.3.3 å¤šç»´åº¦ç»¼åˆè¯„åˆ¤</h3>
<p><strong>ç»¼åˆè¯„åˆ¤å†³ç­–æ ‘</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ComprehensiveJudgment</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;identity&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>      <span class="c1"># èº«ä»½ç»´åº¦</span>
            <span class="s1">&#39;behavior&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>     <span class="c1"># è¡Œä¸ºç»´åº¦</span>
            <span class="s1">&#39;intent&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>       <span class="c1"># æ„å›¾ç»´åº¦</span>
            <span class="s1">&#39;impact&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>       <span class="c1"># å½±å“ç»´åº¦</span>
            <span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="mf">0.15</span>       <span class="c1"># å†å²ç»´åº¦</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">make_judgment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤šç»´åº¦ç»¼åˆåˆ¤æ–­&quot;&quot;&quot;</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># æ”¶é›†å„ç»´åº¦æ•°æ®</span>
        <span class="n">identity_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_identity_assessment</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">behavior_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_analysis</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">intent_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intent_classification</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">impact_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_impact_assessment</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">history_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_historical_record</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>

        <span class="c1"># è®¡ç®—å„ç»´åº¦å¾—åˆ†</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;identity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_identity</span><span class="p">(</span><span class="n">identity_data</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;behavior&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_behavior</span><span class="p">(</span><span class="n">behavior_data</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;intent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_intent</span><span class="p">(</span><span class="n">intent_data</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;impact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_impact</span><span class="p">(</span><span class="n">impact_data</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_history</span><span class="p">(</span><span class="n">history_data</span><span class="p">)</span>

        <span class="c1"># åŠ æƒç»¼åˆ</span>
        <span class="n">total_score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">)</span>

        <span class="c1"># å†³ç­–</span>
        <span class="n">decision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_decision</span><span class="p">(</span><span class="n">total_score</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;agent_id&#39;</span><span class="p">:</span> <span class="n">agent_id</span><span class="p">,</span>
            <span class="s1">&#39;classification&#39;</span><span class="p">:</span> <span class="n">decision</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">],</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">decision</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">],</span>
            <span class="s1">&#39;scores&#39;</span><span class="p">:</span> <span class="n">scores</span><span class="p">,</span>
            <span class="s1">&#39;total_score&#39;</span><span class="p">:</span> <span class="n">total_score</span><span class="p">,</span>
            <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_confidence</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
            <span class="s1">&#39;explanation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_explanation</span><span class="p">(</span><span class="n">decision</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">make_decision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_score</span><span class="p">,</span> <span class="n">dimension_scores</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åŸºäºå¾—åˆ†åšå‡ºå†³ç­–&quot;&quot;&quot;</span>
        <span class="c1"># æ£€æŸ¥æ˜¯å¦æœ‰ç»´åº¦çº¢çº¿</span>
        <span class="k">if</span> <span class="n">dimension_scores</span><span class="p">[</span><span class="s1">&#39;intent&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>  <span class="c1"># æ„å›¾æ˜æ˜¾æ¶æ„</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;malicious&#39;</span><span class="p">,</span>
                <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;block&#39;</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;æ¶æ„æ„å›¾æ˜ç¡®&#39;</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">dimension_scores</span><span class="p">[</span><span class="s1">&#39;impact&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.3</span> <span class="ow">and</span> <span class="n">dimension_scores</span><span class="p">[</span><span class="s1">&#39;behavior&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;suspicious&#39;</span><span class="p">,</span>
                <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;restrict&#39;</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;è¡Œä¸ºå¼‚å¸¸ä¸”å½±å“è¾ƒå¤§&#39;</span>
            <span class="p">}</span>

        <span class="c1"># åŸºäºæ€»åˆ†åˆ†ç±»</span>
        <span class="k">if</span> <span class="n">total_score</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;benign&#39;</span><span class="p">,</span>
                <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;allow&#39;</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;å„é¡¹æŒ‡æ ‡æ­£å¸¸&#39;</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">total_score</span> <span class="o">&gt;=</span> <span class="mf">0.6</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;legitimate&#39;</span><span class="p">,</span>
                <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;allow_with_monitoring&#39;</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;åŸºæœ¬æ­£å¸¸ä½†éœ€è§‚å¯Ÿ&#39;</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">total_score</span> <span class="o">&gt;=</span> <span class="mf">0.4</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span>
                <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;limit&#39;</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;å­˜åœ¨é£é™©éœ€è¦é™åˆ¶&#39;</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;malicious&#39;</span><span class="p">,</span>
                <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;block&#39;</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;ç»¼åˆè¯„åˆ†è¿‡ä½&#39;</span>
            <span class="p">}</span>
</code></pre></div>

<h3 id="1134">11.3.4 è¯¯åˆ¤å¤„ç†ä¸ç”³è¯‰æœºåˆ¶</h3>
<p><strong>ç”³è¯‰æµç¨‹è®¾è®¡</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AppealSystem</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appeal_queue</span> <span class="o">=</span> <span class="n">PriorityQueue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">review_team</span> <span class="o">=</span> <span class="n">ReviewTeam</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_reviewer</span> <span class="o">=</span> <span class="n">AutoReviewer</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">submit_appeal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">appeal_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æäº¤ç”³è¯‰&quot;&quot;&quot;</span>
        <span class="n">appeal</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_appeal_id</span><span class="p">(),</span>
            <span class="s1">&#39;agent_id&#39;</span><span class="p">:</span> <span class="n">agent_id</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">appeal_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
            <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="n">appeal_data</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">],</span>
            <span class="s1">&#39;evidence&#39;</span><span class="p">:</span> <span class="n">appeal_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;evidence&#39;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_priority</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">appeal_data</span><span class="p">),</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;pending&#39;</span>
        <span class="p">}</span>

        <span class="c1"># å¿«é€Ÿè‡ªåŠ¨å®¡æŸ¥</span>
        <span class="n">auto_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_reviewer</span><span class="o">.</span><span class="n">quick_review</span><span class="p">(</span><span class="n">appeal</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">auto_result</span><span class="p">[</span><span class="s1">&#39;can_auto_resolve&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_resolve</span><span class="p">(</span><span class="n">appeal</span><span class="p">,</span> <span class="n">auto_result</span><span class="p">)</span>

        <span class="c1"># åŠ å…¥äººå·¥å®¡æ ¸é˜Ÿåˆ—</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appeal_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">appeal</span><span class="p">)</span>

        <span class="c1"># å‘é€ç¡®è®¤</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_confirmation</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">appeal</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;appeal_id&#39;</span><span class="p">:</span> <span class="n">appeal</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;submitted&#39;</span><span class="p">,</span>
            <span class="s1">&#39;estimated_time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_review_time</span><span class="p">(),</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="n">appeal</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">auto_resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appeal</span><span class="p">,</span> <span class="n">review_result</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è‡ªåŠ¨å¤„ç†æ˜æ˜¾çš„è¯¯åˆ¤&quot;&quot;&quot;</span>
        <span class="n">resolution_actions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;false_positive_blocking&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">unblock_agent</span><span class="p">,</span>
            <span class="s1">&#39;incorrect_classification&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reclassify_agent</span><span class="p">,</span>
            <span class="s1">&#39;outdated_restriction&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lift_restriction</span><span class="p">,</span>
            <span class="s1">&#39;technical_error&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_technical_issue</span>
        <span class="p">}</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">resolution_actions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">review_result</span><span class="p">[</span><span class="s1">&#39;issue_type&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">action</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">action</span><span class="p">(</span><span class="n">appeal</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">record_resolution</span><span class="p">(</span><span class="n">appeal</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_ml_models</span><span class="p">(</span><span class="n">appeal</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>  <span class="c1"># åé¦ˆç»™MLæ¨¡å‹</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;appeal_id&#39;</span><span class="p">:</span> <span class="n">appeal</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;resolved&#39;</span><span class="p">,</span>
                <span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
                <span class="s1">&#39;time_taken&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt; 1 minute&#39;</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">manual_review_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appeal_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;äººå·¥å®¡æ ¸æµç¨‹&quot;&quot;&quot;</span>
        <span class="n">appeal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_appeal</span><span class="p">(</span><span class="n">appeal_id</span><span class="p">)</span>

        <span class="c1"># æ”¶é›†å®Œæ•´ä¸Šä¸‹æ–‡</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;agent_profile&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_agent_profile</span><span class="p">(</span><span class="n">appeal</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;recent_behavior&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_recent_behavior</span><span class="p">(</span><span class="n">appeal</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;similar_cases&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_similar_cases</span><span class="p">(</span><span class="n">appeal</span><span class="p">),</span>
            <span class="s1">&#39;policy_guidelines&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relevant_policies</span><span class="p">(</span><span class="n">appeal</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
        <span class="p">}</span>

        <span class="c1"># åˆ†é…ç»™å®¡æ ¸å‘˜</span>
        <span class="n">reviewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_team</span><span class="o">.</span><span class="n">assign_reviewer</span><span class="p">(</span><span class="n">appeal</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">])</span>

        <span class="c1"># å®¡æ ¸å†³ç­–</span>
        <span class="n">decision</span> <span class="o">=</span> <span class="n">reviewer</span><span class="o">.</span><span class="n">review</span><span class="p">(</span><span class="n">appeal</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

        <span class="c1"># æ‰§è¡Œå†³ç­–</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_decision</span><span class="p">(</span><span class="n">decision</span><span class="p">)</span>

        <span class="c1"># é€šçŸ¥ç»“æœ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_appeal_result</span><span class="p">(</span><span class="n">appeal</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">],</span> <span class="n">decision</span><span class="p">)</span>

        <span class="c1"># æ›´æ–°ç³»ç»Ÿ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_system_rules</span><span class="p">(</span><span class="n">decision</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">decision</span>
</code></pre></div>

<p><strong>è¯¯åˆ¤è¡¥å¿æœºåˆ¶</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>è¡¥å¿ç­‰çº§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 1: å¿«é€Ÿæ¢å¤                       â”‚
â”‚   - ç«‹å³è§£é™¤é™åˆ¶                        â”‚
â”‚   - æ¢å¤åŸæœ‰æƒé™                        â”‚
â”‚   - æ¸…é™¤ä¸è‰¯è®°å½•                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Level 2: ä¿¡èª‰è¡¥å¿                       â”‚
â”‚   - ä¿¡ä»»åˆ†è¡¥å¿ï¼ˆ+0.1ï¼‰                  â”‚
â”‚   - ä¼˜å…ˆå¤„ç†é˜Ÿåˆ—ï¼ˆ7å¤©ï¼‰                 â”‚
â”‚   - ä¸“å±å®¢æœæ”¯æŒ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Level 3: æƒç›Šè¡¥å¿                       â”‚
â”‚   - APIé…é¢ç¿»å€ï¼ˆ30å¤©ï¼‰                 â”‚
â”‚   - å…è´¹æŠ€æœ¯æ”¯æŒ                        â”‚
â”‚   - ä¼˜å…ˆä½“éªŒæ–°åŠŸèƒ½                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Level 4: ç»æµè¡¥å¿                       â”‚
â”‚   - æœåŠ¡è´¹å‡å…                          â”‚
â”‚   - äº‘èµ„æºä»£é‡‘åˆ¸                        â”‚
â”‚   - åˆä½œä¼˜æƒ æ”¿ç­–                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h2 id="114-api">11.4 APIé€Ÿç‡é™åˆ¶çš„æ™ºèƒ½åŒ–è°ƒæ•´</h2>
<p>ä¼ ç»Ÿçš„å›ºå®šé€Ÿç‡é™åˆ¶å·²æ— æ³•æ»¡è¶³AgentæœåŠ¡çš„éœ€æ±‚ã€‚æ™ºèƒ½åŒ–çš„é€Ÿç‡é™åˆ¶éœ€è¦è€ƒè™‘Agentçš„ä¿¡ä»»ç­‰çº§ã€ä¸šåŠ¡åœºæ™¯ã€ç³»ç»Ÿè´Ÿè½½ç­‰å¤šä¸ªå› ç´ ï¼Œå®ç°æ—¢ä¿æŠ¤ç³»ç»Ÿç¨³å®šåˆä¸å½±å“æ­£å¸¸æœåŠ¡çš„åŠ¨æ€å¹³è¡¡ã€‚</p>
<h3 id="1141">11.4.1 åŸºç¡€é™æµç­–ç•¥è®¾è®¡</h3>
<p><strong>å¤šå±‚çº§é™æµæ¶æ„</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>                    é™æµå±‚çº§æ¶æ„
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                            â”‚
    â”‚   å…¨å±€é™æµ (ç³»ç»Ÿä¿æŠ¤)                      â”‚
    â”‚       â†“                                    â”‚
    â”‚   ç§Ÿæˆ·é™æµ (å…¬å¹³æ€§)                        â”‚
    â”‚       â†“                                    â”‚
    â”‚   Agenté™æµ (ä¸ªä½“æ§åˆ¶)                     â”‚
    â”‚       â†“                                    â”‚
    â”‚   APIé™æµ (æ¥å£ä¿æŠ¤)                       â”‚
    â”‚       â†“                                    â”‚
    â”‚   ç”¨æˆ·é™æµ (æœ€ç»ˆç”¨æˆ·)                      â”‚
    â”‚                                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>é™æµç®—æ³•å®ç°</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">RateLimitManager</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithms</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;token_bucket&#39;</span><span class="p">:</span> <span class="n">TokenBucket</span><span class="p">(),</span>
            <span class="s1">&#39;sliding_window&#39;</span><span class="p">:</span> <span class="n">SlidingWindow</span><span class="p">(),</span>
            <span class="s1">&#39;leaky_bucket&#39;</span><span class="p">:</span> <span class="n">LeakyBucket</span><span class="p">(),</span>
            <span class="s1">&#39;adaptive&#39;</span><span class="p">:</span> <span class="n">AdaptiveRateLimit</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">check_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤šå±‚çº§é™æµæ£€æŸ¥&quot;&quot;&quot;</span>
        <span class="c1"># 1. å…¨å±€é™æµ</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_global_limit</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;allowed&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;global_limit_exceeded&#39;</span><span class="p">,</span>
                <span class="s1">&#39;retry_after&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_retry_time</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="c1"># 2. ç§Ÿæˆ·é™æµ</span>
        <span class="n">tenant_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;tenant_id&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_tenant_limit</span><span class="p">(</span><span class="n">tenant_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;allowed&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;tenant_limit_exceeded&#39;</span><span class="p">,</span>
                <span class="s1">&#39;retry_after&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tenant_retry_time</span><span class="p">(</span><span class="n">tenant_id</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="c1"># 3. Agenté™æµ</span>
        <span class="n">agent_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">]</span>
        <span class="n">agent_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_agent_limit</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_agent_limit</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">agent_limit</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;allowed&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;agent_limit_exceeded&#39;</span><span class="p">,</span>
                <span class="s1">&#39;retry_after&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_agent_retry_time</span><span class="p">(</span><span class="n">agent_id</span><span class="p">),</span>
                <span class="s1">&#39;current_limit&#39;</span><span class="p">:</span> <span class="n">agent_limit</span>
            <span class="p">}</span>

        <span class="c1"># 4. APIé™æµ</span>
        <span class="n">api_endpoint</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;endpoint&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_api_limit</span><span class="p">(</span><span class="n">api_endpoint</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;allowed&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;api_limit_exceeded&#39;</span><span class="p">,</span>
                <span class="s1">&#39;retry_after&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_api_retry_time</span><span class="p">(</span><span class="n">api_endpoint</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="c1"># 5. ç”¨æˆ·é™æµï¼ˆå¦‚æœAgentä»£è¡¨ç”¨æˆ·ï¼‰</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_user_limit</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]):</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s1">&#39;allowed&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;user_limit_exceeded&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;retry_after&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_retry_time</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">])</span>
                <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;allowed&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;consumed&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_agent_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–Agentçš„åŠ¨æ€é™æµé…é¢&quot;&quot;&quot;</span>
        <span class="n">base_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;base_limits&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">get_agent_tier</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)]</span>

        <span class="c1"># ä¿¡ä»»åˆ†è°ƒæ•´</span>
        <span class="n">trust_multiplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_trust_multiplier</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>

        <span class="c1"># å†å²è¡¨ç°è°ƒæ•´</span>
        <span class="n">performance_multiplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_performance_multiplier</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>

        <span class="c1"># ç³»ç»Ÿè´Ÿè½½è°ƒæ•´</span>
        <span class="n">load_multiplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_load_multiplier</span><span class="p">()</span>

        <span class="c1"># æ—¶æ®µè°ƒæ•´</span>
        <span class="n">time_multiplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_time_multiplier</span><span class="p">()</span>

        <span class="c1"># è®¡ç®—æœ€ç»ˆé™æµå€¼</span>
        <span class="n">final_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">base_limit</span> <span class="o">*</span> 
            <span class="n">trust_multiplier</span> <span class="o">*</span> 
            <span class="n">performance_multiplier</span> <span class="o">*</span> 
            <span class="n">load_multiplier</span> <span class="o">*</span> 
            <span class="n">time_multiplier</span>
        <span class="p">)</span>

        <span class="c1"># ç¡®ä¿åœ¨åˆç†èŒƒå›´å†…</span>
        <span class="n">min_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;min_limits&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">get_agent_tier</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)]</span>
        <span class="n">max_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;max_limits&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">get_agent_tier</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)]</span>

        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_limit</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_limit</span><span class="p">,</span> <span class="n">final_limit</span><span class="p">))</span>
</code></pre></div>

<p><strong>ä»¤ç‰Œæ¡¶ç®—æ³•ä¼˜åŒ–</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EnhancedTokenBucket</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">refill_rate</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refill_rate</span> <span class="o">=</span> <span class="n">refill_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="n">capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_refill</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">burst_allowance</span> <span class="o">=</span> <span class="n">capacity</span> <span class="o">*</span> <span class="mf">0.2</span>  <span class="c1"># 20%çªå‘å®¹é‡</span>

    <span class="k">def</span> <span class="nf">try_consume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å°è¯•æ¶ˆè´¹ä»¤ç‰Œ&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refill</span><span class="p">()</span>

        <span class="c1"># ä¼˜å…ˆçº§è°ƒæ•´</span>
        <span class="k">if</span> <span class="n">priority</span> <span class="o">==</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">*=</span> <span class="mf">0.8</span>  <span class="c1"># é«˜ä¼˜å…ˆçº§æ¶ˆè€—æ›´å°‘ä»¤ç‰Œ</span>
        <span class="k">elif</span> <span class="n">priority</span> <span class="o">==</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">*=</span> <span class="mf">1.2</span>  <span class="c1"># ä½ä¼˜å…ˆçº§æ¶ˆè€—æ›´å¤šä»¤ç‰Œ</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">&gt;=</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">-=</span> <span class="n">tokens</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span>

        <span class="c1"># æ£€æŸ¥çªå‘å®¹é‡</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">burst_allowance</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">tokens</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">burst_allowance</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">burst_allowance</span> <span class="o">-=</span> <span class="n">tokens</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span>

        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span>

    <span class="k">def</span> <span class="nf">refill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¡¥å……ä»¤ç‰Œ&quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_refill</span>

        <span class="c1"># è®¡ç®—åº”è¡¥å……çš„ä»¤ç‰Œæ•°</span>
        <span class="n">tokens_to_add</span> <span class="o">=</span> <span class="n">elapsed</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">refill_rate</span>

        <span class="c1"># æ›´æ–°ä»¤ç‰Œæ•°ï¼ˆä¸è¶…è¿‡å®¹é‡ï¼‰</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">+</span> <span class="n">tokens_to_add</span><span class="p">)</span>

        <span class="c1"># æ¢å¤çªå‘å®¹é‡</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">burst_allowance</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">burst_allowance</span> <span class="o">+</span> <span class="n">tokens_to_add</span> <span class="o">*</span> <span class="mf">0.1</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_refill</span> <span class="o">=</span> <span class="n">now</span>

    <span class="k">def</span> <span class="nf">get_wait_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡ç®—éœ€è¦ç­‰å¾…çš„æ—¶é—´&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">&gt;=</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">tokens_needed</span> <span class="o">=</span> <span class="n">tokens</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span>
        <span class="n">wait_time</span> <span class="o">=</span> <span class="n">tokens_needed</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">refill_rate</span>

        <span class="k">return</span> <span class="n">wait_time</span>
</code></pre></div>

<h3 id="1142">11.4.2 ä¿¡ä»»åº¦å…³è”çš„åŠ¨æ€é…é¢</h3>
<p><strong>ä¿¡ä»»åº¦ä¸é…é¢æ˜ å°„æ¨¡å‹</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TrustBasedQuota</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trust_tiers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;platinum&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;base_qps&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
                <span class="s1">&#39;burst_multiplier&#39;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span>
                <span class="s1">&#39;soft_limit&#39;</span><span class="p">:</span> <span class="kc">True</span>  <span class="c1"># è½¯é™åˆ¶ï¼Œå¯ä¸´æ—¶è¶…å‡º</span>
            <span class="p">},</span>
            <span class="s1">&#39;gold&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;base_qps&#39;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
                <span class="s1">&#39;burst_multiplier&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                <span class="s1">&#39;soft_limit&#39;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">},</span>
            <span class="s1">&#39;silver&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;base_qps&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="s1">&#39;burst_multiplier&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                <span class="s1">&#39;soft_limit&#39;</span><span class="p">:</span> <span class="kc">False</span>
            <span class="p">},</span>
            <span class="s1">&#39;bronze&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;base_qps&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                <span class="s1">&#39;burst_multiplier&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span>
                <span class="s1">&#39;soft_limit&#39;</span><span class="p">:</span> <span class="kc">False</span>
            <span class="p">},</span>
            <span class="s1">&#39;restricted&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;base_qps&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s1">&#39;burst_multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="s1">&#39;lowest&#39;</span><span class="p">,</span>
                <span class="s1">&#39;soft_limit&#39;</span><span class="p">:</span> <span class="kc">False</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">calculate_dynamic_quota</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡ç®—åŠ¨æ€é…é¢&quot;&quot;&quot;</span>
        <span class="n">trust_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trust_score</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">trust_tier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_to_tier</span><span class="p">(</span><span class="n">trust_score</span><span class="p">)</span>
        <span class="n">tier_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trust_tiers</span><span class="p">[</span><span class="n">trust_tier</span><span class="p">]</span>

        <span class="c1"># åŸºç¡€é…é¢</span>
        <span class="n">base_quota</span> <span class="o">=</span> <span class="n">tier_config</span><span class="p">[</span><span class="s1">&#39;base_qps&#39;</span><span class="p">]</span>

        <span class="c1"># ä¿¡ä»»åˆ†ç²¾ç»†è°ƒæ•´ï¼ˆåœ¨tierå†…éƒ¨ï¼‰</span>
        <span class="n">tier_adjustment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_tier_adjustment</span><span class="p">(</span><span class="n">trust_score</span><span class="p">,</span> <span class="n">trust_tier</span><span class="p">)</span>

        <span class="c1"># è¡Œä¸ºæ¨¡å¼è°ƒæ•´</span>
        <span class="n">behavior_adjustment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_behavior_pattern</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>

        <span class="c1"># è´¡çŒ®åº¦åŠ æˆ</span>
        <span class="n">contribution_bonus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_contribution_bonus</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>

        <span class="c1"># è®¡ç®—æœ€ç»ˆé…é¢</span>
        <span class="n">final_quota</span> <span class="o">=</span> <span class="n">base_quota</span> <span class="o">*</span> <span class="n">tier_adjustment</span> <span class="o">*</span> <span class="n">behavior_adjustment</span> <span class="o">+</span> <span class="n">contribution_bonus</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;quota&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">final_quota</span><span class="p">),</span>
            <span class="s1">&#39;burst_limit&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">final_quota</span> <span class="o">*</span> <span class="n">tier_config</span><span class="p">[</span><span class="s1">&#39;burst_multiplier&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="n">tier_config</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">],</span>
            <span class="s1">&#39;soft_limit&#39;</span><span class="p">:</span> <span class="n">tier_config</span><span class="p">[</span><span class="s1">&#39;soft_limit&#39;</span><span class="p">],</span>
            <span class="s1">&#39;tier&#39;</span><span class="p">:</span> <span class="n">trust_tier</span><span class="p">,</span>
            <span class="s1">&#39;adjustments&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;tier&#39;</span><span class="p">:</span> <span class="n">tier_adjustment</span><span class="p">,</span>
                <span class="s1">&#39;behavior&#39;</span><span class="p">:</span> <span class="n">behavior_adjustment</span><span class="p">,</span>
                <span class="s1">&#39;contribution&#39;</span><span class="p">:</span> <span class="n">contribution_bonus</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">calculate_tier_adjustment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trust_score</span><span class="p">,</span> <span class="n">tier</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åœ¨tierå†…éƒ¨çš„ç²¾ç»†è°ƒæ•´&quot;&quot;&quot;</span>
        <span class="n">tier_ranges</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;platinum&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="s1">&#39;gold&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
            <span class="s1">&#39;silver&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
            <span class="s1">&#39;bronze&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
            <span class="s1">&#39;restricted&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">min_score</span><span class="p">,</span> <span class="n">max_score</span> <span class="o">=</span> <span class="n">tier_ranges</span><span class="p">[</span><span class="n">tier</span><span class="p">]</span>

        <span class="c1"># çº¿æ€§æ’å€¼</span>
        <span class="k">if</span> <span class="n">max_score</span> <span class="o">&gt;</span> <span class="n">min_score</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">trust_score</span> <span class="o">-</span> <span class="n">min_score</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_score</span> <span class="o">-</span> <span class="n">min_score</span><span class="p">)</span>
            <span class="c1"># åœ¨0.8åˆ°1.2ä¹‹é—´è°ƒæ•´</span>
            <span class="k">return</span> <span class="mf">0.8</span> <span class="o">+</span> <span class="n">position</span> <span class="o">*</span> <span class="mf">0.4</span>

        <span class="k">return</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">analyze_behavior_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆ†æè¡Œä¸ºæ¨¡å¼å¯¹é…é¢çš„å½±å“&quot;&quot;&quot;</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_patterns</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>

        <span class="n">adjustments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;consistent_usage&#39;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>      <span class="c1"># ä½¿ç”¨ç¨³å®š</span>
            <span class="s1">&#39;efficient_api_usage&#39;</span><span class="p">:</span> <span class="mf">1.15</span><span class="p">,</span>  <span class="c1"># APIä½¿ç”¨é«˜æ•ˆ</span>
            <span class="s1">&#39;low_error_rate&#39;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>        <span class="c1"># é”™è¯¯ç‡ä½</span>
            <span class="s1">&#39;good_retry_behavior&#39;</span><span class="p">:</span> <span class="mf">1.05</span><span class="p">,</span>  <span class="c1"># é‡è¯•è¡Œä¸ºè‰¯å¥½</span>
            <span class="s1">&#39;respects_limits&#39;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>       <span class="c1"># éµå®ˆé™åˆ¶</span>

            <span class="s1">&#39;bursty_usage&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>          <span class="c1"># ä½¿ç”¨çªå‘</span>
            <span class="s1">&#39;inefficient_calls&#39;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>    <span class="c1"># è°ƒç”¨ä½æ•ˆ</span>
            <span class="s1">&#39;high_error_rate&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>       <span class="c1"># é”™è¯¯ç‡é«˜</span>
            <span class="s1">&#39;aggressive_retry&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>      <span class="c1"># æ¿€è¿›é‡è¯•</span>
            <span class="s1">&#39;limit_violations&#39;</span><span class="p">:</span> <span class="mf">0.6</span>       <span class="c1"># ç»å¸¸è¿åé™åˆ¶</span>
        <span class="p">}</span>

        <span class="n">multiplier</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">adjustment</span> <span class="ow">in</span> <span class="n">adjustments</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">multiplier</span> <span class="o">*=</span> <span class="n">adjustment</span>

        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">))</span>  <span class="c1"># é™åˆ¶åœ¨0.5-1.5ä¹‹é—´</span>
</code></pre></div>

<p><strong>é…é¢åŠ¨æ€è°ƒæ•´æœºåˆ¶</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">QuotaAdjustmentEngine</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjustment_history</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_system</span> <span class="o">=</span> <span class="n">QuotaLearningSystem</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">adjust_quota_realtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">current_usage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å®æ—¶è°ƒæ•´é…é¢&quot;&quot;&quot;</span>
        <span class="n">current_quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_quota</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>

        <span class="c1"># æ”¶é›†å®æ—¶æŒ‡æ ‡</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;usage_rate&#39;</span><span class="p">:</span> <span class="n">current_usage</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span>
            <span class="s1">&#39;error_rate&#39;</span><span class="p">:</span> <span class="n">current_usage</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">current_usage</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;response_time&#39;</span><span class="p">:</span> <span class="n">current_usage</span><span class="p">[</span><span class="s1">&#39;avg_response_time&#39;</span><span class="p">],</span>
            <span class="s1">&#39;queue_depth&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queue_depth</span><span class="p">(</span><span class="n">agent_id</span><span class="p">),</span>
            <span class="s1">&#39;system_load&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_system_load</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1"># åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒæ•´</span>
        <span class="n">adjustment_needed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_adjustment_need</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">adjustment_needed</span><span class="p">:</span>
            <span class="c1"># è®¡ç®—è°ƒæ•´å¹…åº¦</span>
            <span class="n">adjustment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_adjustment</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>

            <span class="c1"># åº”ç”¨è°ƒæ•´</span>
            <span class="n">new_quota</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_adjustment</span><span class="p">(</span><span class="n">current_quota</span><span class="p">,</span> <span class="n">adjustment</span><span class="p">)</span>

            <span class="c1"># è®°å½•è°ƒæ•´</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">record_adjustment</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">&#39;old_quota&#39;</span><span class="p">:</span> <span class="n">current_quota</span><span class="p">,</span>
                <span class="s1">&#39;new_quota&#39;</span><span class="p">:</span> <span class="n">new_quota</span><span class="p">,</span>
                <span class="s1">&#39;metrics&#39;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="n">adjustment</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">],</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="p">})</span>

            <span class="c1"># å­¦ä¹ ç³»ç»Ÿåé¦ˆ</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">learning_system</span><span class="o">.</span><span class="n">feedback</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">adjustment</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">new_quota</span>

        <span class="k">return</span> <span class="n">current_quota</span>

    <span class="k">def</span> <span class="nf">calculate_adjustment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">metrics</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡ç®—é…é¢è°ƒæ•´&quot;&quot;&quot;</span>
        <span class="n">adjustment</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;factor&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># ä½¿ç”¨ç‡è°ƒæ•´</span>
        <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;usage_rate&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;error_rate&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># é«˜ä½¿ç”¨ç‡ä½†ä½é”™è¯¯</span>
                <span class="n">adjustment</span><span class="p">[</span><span class="s1">&#39;factor&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1.2</span>
                <span class="n">adjustment</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;é«˜æ•ˆä½¿ç”¨&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;usage_rate&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="n">adjustment</span><span class="p">[</span><span class="s1">&#39;factor&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.8</span>
            <span class="n">adjustment</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ä½¿ç”¨ç‡è¿‡ä½&#39;</span><span class="p">)</span>

        <span class="c1"># é”™è¯¯ç‡è°ƒæ•´</span>
        <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;error_rate&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="n">adjustment</span><span class="p">[</span><span class="s1">&#39;factor&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.7</span>
            <span class="n">adjustment</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;é”™è¯¯ç‡è¿‡é«˜&#39;</span><span class="p">)</span>

        <span class="c1"># ç³»ç»Ÿè´Ÿè½½è°ƒæ•´</span>
        <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;system_load&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="n">adjustment</span><span class="p">[</span><span class="s1">&#39;factor&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.9</span>
            <span class="n">adjustment</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ç³»ç»Ÿè´Ÿè½½é«˜&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;system_load&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
            <span class="n">adjustment</span><span class="p">[</span><span class="s1">&#39;factor&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1.1</span>
            <span class="n">adjustment</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ç³»ç»Ÿç©ºé—²&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">adjustment</span>
</code></pre></div>

<h3 id="1143">11.4.3 ä¸šåŠ¡åœºæ™¯çš„å·®å¼‚åŒ–é™åˆ¶</h3>
<p><strong>åœºæ™¯åŒ–é™æµç­–ç•¥</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ScenarioBasedRateLimit</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;user_query&#39;</span><span class="p">:</span> <span class="p">{</span>          <span class="c1"># ç”¨æˆ·æŸ¥è¯¢åœºæ™¯</span>
                <span class="s1">&#39;base_limit&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                <span class="s1">&#39;burst_allowed&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cache_enabled&#39;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">},</span>
            <span class="s1">&#39;batch_operation&#39;</span><span class="p">:</span> <span class="p">{</span>     <span class="c1"># æ‰¹é‡æ“ä½œåœºæ™¯</span>
                <span class="s1">&#39;base_limit&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s1">&#39;burst_allowed&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span>
                <span class="s1">&#39;queue_enabled&#39;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">},</span>
            <span class="s1">&#39;realtime_tracking&#39;</span><span class="p">:</span> <span class="p">{</span>   <span class="c1"># å®æ—¶è¿½è¸ªåœºæ™¯</span>
                <span class="s1">&#39;base_limit&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                <span class="s1">&#39;burst_allowed&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
                <span class="s1">&#39;websocket_enabled&#39;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">},</span>
            <span class="s1">&#39;data_sync&#39;</span><span class="p">:</span> <span class="p">{</span>          <span class="c1"># æ•°æ®åŒæ­¥åœºæ™¯</span>
                <span class="s1">&#39;base_limit&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                <span class="s1">&#39;burst_allowed&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                <span class="s1">&#39;batch_window&#39;</span><span class="p">:</span> <span class="mi">60</span>  <span class="c1"># ç§’</span>
            <span class="p">},</span>
            <span class="s1">&#39;analytics&#39;</span><span class="p">:</span> <span class="p">{</span>          <span class="c1"># æ•°æ®åˆ†æåœºæ™¯</span>
                <span class="s1">&#39;base_limit&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;burst_allowed&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="s1">&#39;lowest&#39;</span><span class="p">,</span>
                <span class="s1">&#39;off_peak_bonus&#39;</span><span class="p">:</span> <span class="mf">2.0</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_scenario_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–åœºæ™¯åŒ–çš„é™æµé…ç½®&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">scenario</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">:</span>
            <span class="n">scenario</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenarios</span><span class="p">[</span><span class="n">scenario</span><span class="p">]</span>
        <span class="n">base_limit</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;base_limit&#39;</span><span class="p">]</span>

        <span class="c1"># æ ¹æ®åœºæ™¯ç‰¹æ€§è°ƒæ•´</span>
        <span class="n">adjusted_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_scenario</span><span class="p">(</span>
            <span class="n">base_limit</span><span class="p">,</span> 
            <span class="n">scenario</span><span class="p">,</span> 
            <span class="n">context</span>
        <span class="p">)</span>

        <span class="c1"># æ—¶æ®µè°ƒæ•´</span>
        <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="s1">&#39;analytics&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_off_peak</span><span class="p">():</span>
            <span class="n">adjusted_limit</span> <span class="o">*=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;off_peak_bonus&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># Agentç­‰çº§è°ƒæ•´</span>
        <span class="n">agent_tier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_agent_tier</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">tier_multiplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tier_multiplier</span><span class="p">(</span><span class="n">agent_tier</span><span class="p">,</span> <span class="n">scenario</span><span class="p">)</span>

        <span class="n">final_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">adjusted_limit</span> <span class="o">*</span> <span class="n">tier_multiplier</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">final_limit</span><span class="p">,</span>
            <span class="s1">&#39;burst&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;burst_allowed&#39;</span><span class="p">],</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">],</span>
            <span class="s1">&#39;special_features&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_special_features</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">adjust_for_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_limit</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ ¹æ®åœºæ™¯ä¸Šä¸‹æ–‡è°ƒæ•´é™åˆ¶&quot;&quot;&quot;</span>
        <span class="n">adjustments</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="s1">&#39;user_query&#39;</span><span class="p">:</span>
            <span class="c1"># ç”¨æˆ·æŸ¥è¯¢æ ¹æ®æŸ¥è¯¢å¤æ‚åº¦è°ƒæ•´</span>
            <span class="n">complexity</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;query_complexity&#39;</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">complexity</span> <span class="o">==</span> <span class="s1">&#39;simple&#39;</span><span class="p">:</span>
                <span class="n">adjustments</span> <span class="o">*=</span> <span class="mf">1.5</span>
            <span class="k">elif</span> <span class="n">complexity</span> <span class="o">==</span> <span class="s1">&#39;complex&#39;</span><span class="p">:</span>
                <span class="n">adjustments</span> <span class="o">*=</span> <span class="mf">0.7</span>

        <span class="k">elif</span> <span class="n">scenario</span> <span class="o">==</span> <span class="s1">&#39;batch_operation&#39;</span><span class="p">:</span>
            <span class="c1"># æ‰¹é‡æ“ä½œæ ¹æ®æ‰¹æ¬¡å¤§å°è°ƒæ•´</span>
            <span class="n">batch_size</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_size&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">batch_size</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="n">adjustments</span> <span class="o">*=</span> <span class="mf">0.5</span>
            <span class="k">elif</span> <span class="n">batch_size</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">adjustments</span> <span class="o">*=</span> <span class="mf">1.5</span>

        <span class="k">elif</span> <span class="n">scenario</span> <span class="o">==</span> <span class="s1">&#39;realtime_tracking&#39;</span><span class="p">:</span>
            <span class="c1"># å®æ—¶è¿½è¸ªæ ¹æ®è¿½è¸ªå¯¹è±¡æ•°è°ƒæ•´</span>
            <span class="n">tracking_count</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tracking_count&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">adjustments</span> <span class="o">*=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">tracking_count</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">base_limit</span> <span class="o">*</span> <span class="n">adjustments</span>
</code></pre></div>

<p><strong>APIçº§åˆ«çš„å·®å¼‚åŒ–é™åˆ¶</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>APIåˆ†ç±»ä¸é™æµç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é«˜é¢‘æŸ¥è¯¢ç±» API                                   â”‚
â”‚   - å•†å®¶æœç´¢: 1000 QPS                          â”‚
â”‚   - èœå“æµè§ˆ: 2000 QPS                          â”‚
â”‚   - ä»·æ ¼æŸ¥è¯¢: 500 QPS                           â”‚
â”‚   ç­–ç•¥: ç¼“å­˜ä¼˜å…ˆï¼ŒçŸ­æ—¶çªå‘å…è®¸                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ äº¤æ˜“ç±» API                                       â”‚
â”‚   - ä¸‹å•: 10 QPS                                â”‚
â”‚   - æ”¯ä»˜: 5 QPS                                 â”‚
â”‚   - å–æ¶ˆ: 20 QPS                                â”‚
â”‚   ç­–ç•¥: ä¸¥æ ¼é™åˆ¶ï¼Œé˜²æ¬ºè¯ˆæ£€æµ‹                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®ç±» API                                       â”‚
â”‚   - æŠ¥è¡¨å¯¼å‡º: 1 QPM                             â”‚
â”‚   - å†å²æŸ¥è¯¢: 10 QPS                            â”‚
â”‚   - ç»Ÿè®¡åˆ†æ: 5 QPS                             â”‚
â”‚   ç­–ç•¥: é˜Ÿåˆ—å¤„ç†ï¼Œéé«˜å³°æ—¶æ®µåŠ æˆ                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®æ—¶ç±» API                                       â”‚
â”‚   - ä½ç½®æ›´æ–°: 100 QPS                           â”‚
â”‚   - çŠ¶æ€æ¨é€: 50 QPS                            â”‚
â”‚   - æ¶ˆæ¯é€šçŸ¥: 200 QPS                           â”‚
â”‚   ç­–ç•¥: WebSocketä¼˜å…ˆï¼Œé™çº§åˆ°è½®è¯¢                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="1144">11.4.4 çªå‘æµé‡çš„å¼¹æ€§å¤„ç†</h3>
<p><strong>å¼¹æ€§é™æµæœºåˆ¶</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ElasticRateLimiter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">burst_detector</span> <span class="o">=</span> <span class="n">BurstDetector</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacity_manager</span> <span class="o">=</span> <span class="n">CapacityManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_manager</span> <span class="o">=</span> <span class="n">QueueManager</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤„ç†è¯·æ±‚withå¼¹æ€§é™æµ&quot;&quot;&quot;</span>
        <span class="c1"># æ£€æµ‹æ˜¯å¦ä¸ºçªå‘æµé‡</span>
        <span class="n">is_burst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">burst_detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">is_burst</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_burst_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_normal_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_burst_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤„ç†çªå‘è¯·æ±‚&quot;&quot;&quot;</span>
        <span class="n">agent_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">]</span>

        <span class="c1"># è¯„ä¼°çªå‘åˆç†æ€§</span>
        <span class="n">burst_evaluation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_burst</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">burst_evaluation</span><span class="p">[</span><span class="s1">&#39;legitimate&#39;</span><span class="p">]:</span>
            <span class="c1"># åˆç†çªå‘ï¼Œæä¾›å¼¹æ€§å®¹é‡</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_burst_strategy</span><span class="p">(</span><span class="n">burst_evaluation</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s1">&#39;immediate&#39;</span><span class="p">:</span>
                <span class="c1"># ç«‹å³å¤„ç†</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_with_burst_capacity</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s1">&#39;queue&#39;</span><span class="p">:</span>
                <span class="c1"># é˜Ÿåˆ—ç¼“å†²</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s1">&#39;degrade&#39;</span><span class="p">:</span>
                <span class="c1"># æœåŠ¡é™çº§</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_with_degradation</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># å¼‚å¸¸çªå‘ï¼Œä¸¥æ ¼é™åˆ¶</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_burst</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">burst_evaluation</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">evaluate_burst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¯„ä¼°çªå‘æµé‡çš„åˆç†æ€§&quot;&quot;&quot;</span>
        <span class="n">evaluation</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;legitimate&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="c1"># å†å²æ¨¡å¼åˆ†æ</span>
        <span class="n">historical_bursts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_historical_bursts</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_regular_burst_pattern</span><span class="p">(</span><span class="n">historical_bursts</span><span class="p">):</span>
            <span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.3</span>
            <span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ç¬¦åˆå†å²çªå‘æ¨¡å¼&#39;</span><span class="p">)</span>

        <span class="c1"># ä¸šåŠ¡é€»è¾‘éªŒè¯</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_business_driven_burst</span><span class="p">(</span><span class="n">agent_id</span><span class="p">):</span>
            <span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.4</span>
            <span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ä¸šåŠ¡é©±åŠ¨çš„åˆç†çªå‘&#39;</span><span class="p">)</span>

        <span class="c1"># ä¿¡ä»»åº¦æ£€æŸ¥</span>
        <span class="n">trust_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trust_score</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trust_score</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
            <span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.3</span>
            <span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;é«˜ä¿¡ä»»åº¦Agent&#39;</span><span class="p">)</span>

        <span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;legitimate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span>

        <span class="k">return</span> <span class="n">evaluation</span>

    <span class="k">def</span> <span class="nf">select_burst_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é€‰æ‹©çªå‘å¤„ç†ç­–ç•¥&quot;&quot;&quot;</span>
        <span class="n">confidence</span> <span class="o">=</span> <span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;immediate&#39;</span>  <span class="c1"># é«˜ç½®ä¿¡åº¦ï¼Œç«‹å³å¤„ç†</span>
        <span class="k">elif</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;queue&#39;</span>      <span class="c1"># ä¸­ç½®ä¿¡åº¦ï¼Œé˜Ÿåˆ—ç¼“å†²</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;degrade&#39;</span>    <span class="c1"># ä½ç½®ä¿¡åº¦ï¼ŒæœåŠ¡é™çº§</span>

    <span class="k">def</span> <span class="nf">process_with_burst_capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨çªå‘å®¹é‡å¤„ç†è¯·æ±‚&quot;&quot;&quot;</span>
        <span class="c1"># åŠ¨æ€æ‰©å±•å®¹é‡</span>
        <span class="n">expanded_capacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity_manager</span><span class="o">.</span><span class="n">expand_capacity</span><span class="p">(</span>
            <span class="n">request</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">],</span>
            <span class="n">factor</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="mi">60</span>  <span class="c1"># 60ç§’</span>
        <span class="p">)</span>

        <span class="c1"># å¤„ç†è¯·æ±‚</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">expanded_capacity</span><span class="p">)</span>

        <span class="c1"># è®°å½•çªå‘ä½¿ç”¨</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">record_burst_usage</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">],</span> <span class="n">expanded_capacity</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>

<p><strong>æ™ºèƒ½é˜Ÿåˆ—ç®¡ç†</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">IntelligentQueueManager</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queues</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;critical&#39;</span><span class="p">:</span> <span class="n">PriorityQueue</span><span class="p">(),</span>
            <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="n">PriorityQueue</span><span class="p">(),</span>
            <span class="s1">&#39;normal&#39;</span><span class="p">:</span> <span class="n">Queue</span><span class="p">(),</span>
            <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">Queue</span><span class="p">(),</span>
            <span class="s1">&#39;batch&#39;</span><span class="p">:</span> <span class="n">BatchQueue</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_metrics</span> <span class="o">=</span> <span class="n">QueueMetrics</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">enqueue_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ™ºèƒ½å…¥é˜Ÿ&quot;&quot;&quot;</span>
        <span class="n">priority</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_priority</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">queue_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_queue</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span>

        <span class="c1"># æ£€æŸ¥é˜Ÿåˆ—å®¹é‡</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_queue_full</span><span class="p">(</span><span class="n">queue_type</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_queue_overflow</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">queue_type</span><span class="p">)</span>

        <span class="c1"># æ·»åŠ åˆ°é˜Ÿåˆ—</span>
        <span class="n">queue_item</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;request&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="n">priority</span><span class="p">,</span>
            <span class="s1">&#39;enqueue_time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
            <span class="s1">&#39;ttl&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_ttl</span><span class="p">(</span><span class="n">request</span><span class="p">),</span>
            <span class="s1">&#39;retry_count&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">queues</span><span class="p">[</span><span class="n">queue_type</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">queue_item</span><span class="p">)</span>

        <span class="c1"># è¿”å›é˜Ÿåˆ—ä½ç½®ä¿¡æ¯</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;queued&#39;</span><span class="p">,</span>
            <span class="s1">&#39;queue_type&#39;</span><span class="p">:</span> <span class="n">queue_type</span><span class="p">,</span>
            <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queue_position</span><span class="p">(</span><span class="n">queue_type</span><span class="p">,</span> <span class="n">request</span><span class="p">),</span>
            <span class="s1">&#39;estimated_wait&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_wait_time</span><span class="p">(</span><span class="n">queue_type</span><span class="p">),</span>
            <span class="s1">&#39;queue_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_queue_id</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">calculate_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡ç®—è¯·æ±‚ä¼˜å…ˆçº§&quot;&quot;&quot;</span>
        <span class="n">base_priority</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="c1"># Agentä¿¡ä»»åº¦åŠ æˆ</span>
        <span class="n">trust_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trust_score</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">])</span>
        <span class="n">base_priority</span> <span class="o">+=</span> <span class="n">trust_score</span> <span class="o">*</span> <span class="mi">20</span>

        <span class="c1"># ä¸šåŠ¡é‡è¦æ€§åŠ æˆ</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;business_critical&#39;</span><span class="p">):</span>
            <span class="n">base_priority</span> <span class="o">+=</span> <span class="mi">30</span>

        <span class="c1"># ç­‰å¾…æ—¶é—´è¡¥å¿</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;retry_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">base_priority</span> <span class="o">+=</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;retry_count&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>

        <span class="c1"># SLAè¦æ±‚</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sla_level&#39;</span><span class="p">):</span>
            <span class="n">sla_bonus</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;platinum&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;gold&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;silver&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
            <span class="n">base_priority</span> <span class="o">+=</span> <span class="n">sla_bonus</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;sla_level&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">base_priority</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">estimate_wait_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¼°ç®—ç­‰å¾…æ—¶é—´&quot;&quot;&quot;</span>
        <span class="n">queue_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queues</span><span class="p">[</span><span class="n">queue_type</span><span class="p">]</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span>
        <span class="n">avg_processing_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_metrics</span><span class="o">.</span><span class="n">get_avg_processing_time</span><span class="p">(</span><span class="n">queue_type</span><span class="p">)</span>
        <span class="n">current_throughput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_metrics</span><span class="o">.</span><span class="n">get_current_throughput</span><span class="p">(</span><span class="n">queue_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">current_throughput</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">estimated_wait</span> <span class="o">=</span> <span class="n">queue_length</span> <span class="o">/</span> <span class="n">current_throughput</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">estimated_wait</span> <span class="o">=</span> <span class="n">queue_length</span> <span class="o">*</span> <span class="n">avg_processing_time</span>

        <span class="c1"># è€ƒè™‘é˜Ÿåˆ—ç±»å‹çš„å¤„ç†ç‰¹æ€§</span>
        <span class="k">if</span> <span class="n">queue_type</span> <span class="o">==</span> <span class="s1">&#39;batch&#39;</span><span class="p">:</span>
            <span class="c1"># æ‰¹å¤„ç†é˜Ÿåˆ—ç­‰å¾…åˆ°æ‰¹æ¬¡æ»¡</span>
            <span class="n">batch_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_batch_wait</span><span class="p">()</span>
            <span class="n">estimated_wait</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">estimated_wait</span><span class="p">,</span> <span class="n">batch_wait</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">estimated_wait</span>
</code></pre></div>

<h2 id="115-agent">11.5 Agentå‹å¥½çš„æ¥å£è®¾è®¡</h2>
<h3 id="1151">11.5.1 æ ‡å‡†åŒ–åè®®æ”¯æŒ</h3>
<h3 id="1152">11.5.2 æ‰¹é‡æ“ä½œæ¥å£ä¼˜åŒ–</h3>
<h3 id="1153">11.5.3 é•¿è¿æ¥ä¸è®¢é˜…æœºåˆ¶</h3>
<h3 id="1154">11.5.4 é”™è¯¯å¤„ç†ä¸é‡è¯•ç­–ç•¥</h3>
<h2 id="116">11.6 ç”¨æˆ·æˆæƒä¸ä»£ç†æœºåˆ¶</h2>
<h3 id="1161-oauth-20">11.6.1 OAuth 2.0æˆæƒæ¡†æ¶å®ç°</h3>
<h3 id="1162">11.6.2 æƒé™ç²’åº¦æ§åˆ¶</h3>
<h3 id="1163">11.6.3 æˆæƒæœ‰æ•ˆæœŸç®¡ç†</h3>
<h3 id="1164">11.6.4 å®¡è®¡æ—¥å¿—ä¸è¿½æº¯</h3>
<h2 id="117">11.7 åˆè§„æ€§æ¡†æ¶ä¸éšç§ä¿æŠ¤</h2>
<h3 id="1171">11.7.1 æ•°æ®æœ€å°åŒ–åŸåˆ™</h3>
<h3 id="1172">11.7.2 ç”¨æˆ·çŸ¥æƒ…æƒä¿éšœ</h3>
<h3 id="1173">11.7.3 æ•°æ®å®‰å…¨ä¼ è¾“ä¸å­˜å‚¨</h3>
<h3 id="1174">11.7.4 è·¨å¢ƒæ•°æ®æµåŠ¨åˆè§„</h3>
<h2 id="118-agent">11.8 Agentç”Ÿæ€çš„åŸ¹è‚²ä¸æ²»ç†</h2>
<h3 id="1181">11.8.1 å¼€å‘è€…æ¿€åŠ±æœºåˆ¶</h3>
<h3 id="1182">11.8.2 è´¨é‡è®¤è¯ä½“ç³»</h3>
<h3 id="1183">11.8.3 è¿è§„è¡Œä¸ºå¤„ç½š</h3>
<h3 id="1184">11.8.4 ç¤¾åŒºå…±å»ºä¸åé¦ˆ</h3>
<h2 id="_3">æœ¬ç« å°ç»“</h2>
<h2 id="_4">ç»ƒä¹ é¢˜</h2>
<h2 id="gotchas">å¸¸è§é™·é˜±ä¸é”™è¯¯ï¼ˆGotchasï¼‰</h2>
            </article>
            
            <nav class="page-nav"><a href="chapter10.html" class="nav-link prev">â† ç¬¬10ç« ï¼šåæœºå™¨äººæ»¥ç”¨ä¸è¯„è®ºçœŸå®æ€§ä¿éšœ</a><a href="chapter12.html" class="nav-link next">ç¬¬12ç« ï¼šç¾å›¢Appä¸è¶…çº§Appæ¶æ„ â†’</a></nav>
        </main>
    </div>
</body>
</html>